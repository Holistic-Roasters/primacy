<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APEX: Stroop Cognitive Control Test</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --color-black: #080808;
            --color-dark-grey: #1a1a1a;
            --color-mid-grey: #2e2e2e;
            --color-light-grey: #888888;
            --color-white: #f5f5f5;
            --color-accent: #00ff9d;
            --color-warning: #ff6b6b;
            --color-excellent: #00ff9d;
            --color-good: #ffcc00;
            --color-average: #ff9966;
            --color-poor: #ff6b6b;
            --color-red: #ff3333;
            --color-blue: #3366ff;
            --color-green: #33ff33;
            --color-yellow: #ffff33;
            --color-purple: #cc33ff;
            --color-orange: #ff9933;
            --font-primary: 'Roboto', sans-serif;
            --font-display: 'Roboto Condensed', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--color-black);
            font-family: var(--font-primary);
            color: var(--color-white);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 0;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .header h1 {
            font-family: var(--font-display);
            font-size: 3rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, var(--color-accent), var(--color-white));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.2rem;
            color: var(--color-light-grey);
            max-width: 700px;
            margin: 0 auto;
        }

        .test-container {
            background: var(--color-dark-grey);
            border-radius: 20px;
            padding: 2rem;
            position: relative;
            box-shadow: 0 0 50px rgba(0, 255, 157, 0.1);
            margin-bottom: 2rem;
        }

        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .mode-btn {
            background: var(--color-black);
            border: 2px solid var(--color-mid-grey);
            color: var(--color-light-grey);
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
            font-weight: 500;
            position: relative;
        }

        .mode-btn:hover {
            border-color: var(--color-accent);
            color: var(--color-accent);
        }

        .mode-btn.active {
            background: var(--color-accent);
            color: var(--color-black);
            border-color: var(--color-accent);
        }

        .mode-description {
            display: block;
            font-size: 0.7rem;
            opacity: 0.8;
            margin-top: 3px;
            font-weight: normal;
        }

        .test-config {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .config-item {
            text-align: center;
        }

        .config-label {
            color: var(--color-accent);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .config-value {
            font-family: var(--font-display);
            font-size: 1.5rem;
            color: var(--color-white);
        }

        .instructions {
            text-align: center;
            margin-bottom: 2rem;
            padding: 20px;
            background: var(--color-black);
            border-radius: 15px;
            border-left: 4px solid var(--color-accent);
        }

        .instructions h3 {
            font-family: var(--font-display);
            font-size: 1.5rem;
            color: var(--color-accent);
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .instructions p {
            color: var(--color-light-grey);
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .key-hint {
            display: inline-block;
            background: var(--color-mid-grey);
            padding: 5px 10px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9rem;
            margin: 0 5px;
            border: 1px solid var(--color-light-grey);
        }

        .stimulus-container {
            position: relative;
            width: 500px;
            height: 300px;
            margin: 0 auto 2rem;
            background: var(--color-black);
            border-radius: 15px;
            border: 2px solid var(--color-mid-grey);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stimulus-word {
            font-family: var(--font-display);
            font-size: 4rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 3px;
            transition: all 0.2s ease;
            text-shadow: 0 0 20px currentColor;
            opacity: 0;
            transform: scale(0.8);
        }

        .stimulus-word.active {
            opacity: 1;
            transform: scale(1);
        }

        .stimulus-word.correct {
            transform: scale(1.1);
            filter: brightness(1.3);
        }

        .stimulus-word.incorrect {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .progress-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 15px 20px;
            background: var(--color-black);
            border-radius: 15px;
        }

        .progress-info {
            display: flex;
            gap: 30px;
        }

        .progress-item {
            text-align: center;
        }

        .progress-label {
            color: var(--color-light-grey);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .progress-value {
            font-family: var(--font-display);
            font-size: 1.3rem;
            color: var(--color-accent);
            margin-top: 3px;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: var(--color-mid-grey);
            border-radius: 4px;
            margin: 0 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--color-accent), var(--color-white));
            border-radius: 4px;
            width: 0%;
            transition: width 0.3s ease;
        }

        .response-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 2rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .color-btn {
            padding: 20px;
            border-radius: 15px;
            border: 3px solid;
            background: var(--color-black);
            color: var(--color-white);
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .color-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(255, 255, 255, 0.2);
        }

        .color-btn.pressed {
            transform: scale(0.95);
            filter: brightness(1.3);
        }

        .color-btn.red {
            border-color: var(--color-red);
            background: linear-gradient(135deg, var(--color-black), rgba(255, 51, 51, 0.1));
        }

        .color-btn.red:hover {
            box-shadow: 0 5px 20px rgba(255, 51, 51, 0.3);
        }

        .color-btn.blue {
            border-color: var(--color-blue);
            background: linear-gradient(135deg, var(--color-black), rgba(51, 102, 255, 0.1));
        }

        .color-btn.blue:hover {
            box-shadow: 0 5px 20px rgba(51, 102, 255, 0.3);
        }

        .color-btn.green {
            border-color: var(--color-green);
            background: linear-gradient(135deg, var(--color-black), rgba(51, 255, 51, 0.1));
        }

        .color-btn.green:hover {
            box-shadow: 0 5px 20px rgba(51, 255, 51, 0.3);
        }

        .color-btn.yellow {
            border-color: var(--color-yellow);
            background: linear-gradient(135deg, var(--color-black), rgba(255, 255, 51, 0.1));
        }

        .color-btn.yellow:hover {
            box-shadow: 0 5px 20px rgba(255, 255, 51, 0.3);
        }

        .color-btn.purple {
            border-color: var(--color-purple);
            background: linear-gradient(135deg, var(--color-black), rgba(204, 51, 255, 0.1));
        }

        .color-btn.purple:hover {
            box-shadow: 0 5px 20px rgba(204, 51, 255, 0.3);
        }

        .color-btn.orange {
            border-color: var(--color-orange);
            background: linear-gradient(135deg, var(--color-black), rgba(255, 153, 51, 0.1));
        }

        .color-btn.orange:hover {
            box-shadow: 0 5px 20px rgba(255, 153, 51, 0.3);
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .control-btn {
            background: var(--color-accent);
            color: var(--color-black);
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .control-btn:hover {
            background: var(--color-white);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 157, 0.3);
        }

        .control-btn:disabled {
            background: var(--color-mid-grey);
            color: var(--color-light-grey);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .control-btn.pause {
            background: var(--color-warning);
        }

        .message-display {
            text-align: center;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 2rem;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .message-display.waiting {
            background: rgba(255, 107, 107, 0.1);
            color: var(--color-warning);
            border: 2px solid var(--color-warning);
        }

        .message-display.active {
            background: rgba(0, 255, 157, 0.1);
            color: var(--color-accent);
            border: 2px solid var(--color-accent);
        }

        .message-display.complete {
            background: rgba(255, 255, 255, 0.1);
            color: var(--color-white);
            border: 2px solid var(--color-white);
        }

        .results-container {
            background: var(--color-dark-grey);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 0 50px rgba(0, 255, 157, 0.1);
        }

        .results-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .results-header h2 {
            font-family: var(--font-display);
            font-size: 2rem;
            color: var(--color-accent);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--color-black);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid var(--color-mid-grey);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: var(--color-accent);
            transform: translateY(-2px);
        }

        .stat-value {
            font-family: var(--font-display);
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--color-light-grey);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
        }

        .performance-indicator {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 10px;
        }

        .excellent { 
            background: var(--color-excellent); 
            color: var(--color-black); 
        }
        .good { 
            background: var(--color-good); 
            color: var(--color-black); 
        }
        .average { 
            background: var(--color-average); 
            color: var(--color-black); 
        }
        .poor { 
            background: var(--color-poor); 
            color: var(--color-white); 
        }

        .stroop-analysis {
            background: var(--color-black);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        .analysis-header {
            color: var(--color-accent);
            font-family: var(--font-display);
            font-size: 1.3rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
        }

        .interference-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .interference-card {
            background: var(--color-mid-grey);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .interference-title {
            color: var(--color-accent);
            font-weight: bold;
            margin-bottom: 10px;
            text-transform: uppercase;
            font-size: 0.9rem;
        }

        .interference-value {
            font-family: var(--font-display);
            font-size: 2rem;
            color: var(--color-white);
            margin-bottom: 5px;
        }

        .interference-change {
            font-size: 0.8rem;
            color: var(--color-light-grey);
        }

        .trial-history {
            background: var(--color-black);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        .history-header {
            color: var(--color-accent);
            font-family: var(--font-display);
            font-size: 1.3rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
        }

        .trial-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 5px;
            max-height: 200px;
            overflow-y: auto;
        }

        .trial-result {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            border: 1px solid var(--color-mid-grey);
            position: relative;
            cursor: pointer;
        }

        .trial-result.correct {
            background: var(--color-excellent);
            color: var(--color-black);
        }

        .trial-result.incorrect {
            background: var(--color-poor);
            color: var(--color-white);
        }

        .trial-result.congruent {
            border: 2px solid var(--color-accent);
        }

        .trial-result.incongruent {
            border: 2px solid var(--color-warning);
        }

        .countdown {
            font-family: var(--font-display);
            font-size: 4rem;
            color: var(--color-accent);
            text-align: center;
            text-shadow: 0 0 20px var(--color-accent);
            margin: 2rem 0;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .stimulus-container {
                width: 350px;
                height: 250px;
            }

            .stimulus-word {
                font-size: 3rem;
            }

            .response-buttons {
                grid-template-columns: repeat(2, 1fr);
            }

            .mode-selector {
                flex-direction: column;
                align-items: center;
            }

            .mode-btn {
                width: 250px;
            }

            .test-config {
                flex-direction: column;
                gap: 15px;
            }

            .controls {
                flex-direction: column;
                align-items: center;
            }

            .control-btn {
                width: 200px;
            }
        }

        .hidden {
            display: none;
        }

        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(0, 255, 157, 0.3); }
            to { box-shadow: 0 0 40px rgba(0, 255, 157, 0.6); }
        }

        .glow {
            animation: glow 0.5s ease-in-out infinite alternate;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>APEX STROOP</h1>
            <p>Challenge your cognitive control and inhibitory function. Overcome automatic responses and measure your mental flexibility under interference.</p>
        </div>

        <div class="test-container">
            <div class="mode-selector">
                <button class="mode-btn active" data-mode="classic">
                    Classic Stroop
                    <span class="mode-description">Colors vs Words</span>
                </button>
                <button class="mode-btn" data-mode="emotional">
                    Emotional Stroop
                    <span class="mode-description">Emotion Words</span>
                </button>
                <button class="mode-btn" data-mode="numerical">
                    Numerical Stroop
                    <span class="mode-description">Numbers vs Quantity</span>
                </button>
                <button class="mode-btn" data-mode="spatial">
                    Spatial Stroop
                    <span class="mode-description">Position vs Word</span>
                </button>
            </div>

            <div class="test-config">
                <div class="config-item">
                    <div class="config-label">Mode</div>
                    <div class="config-value" id="testMode">Classic</div>
                </div>
                <div class="config-item">
                    <div class="config-label">Trials</div>
                    <div class="config-value" id="totalTrials">40</div>
                </div>
                <div class="config-item">
                    <div class="config-label">Speed</div>
                    <div class="config-value" id="trialSpeed">2.0s</div>
                </div>
                <div class="config-item">
                    <div class="config-label">Interference</div>
                    <div class="config-value" id="interferenceLevel">50%</div>
                </div>
            </div>

            <div class="instructions" id="instructions">
                <h3>Classic Stroop Test</h3>
                <p>Identify the <strong>COLOR</strong> of each word, not what the word says. Ignore the word meaning and focus only on the color.</p>
                <p>Use the color buttons below or keyboard shortcuts: <span class="key-hint">R</span> Red, <span class="key-hint">B</span> Blue, <span class="key-hint">G</span> Green, <span class="key-hint">Y</span> Yellow</p>
            </div>

            <div class="progress-container">
                <div class="progress-info">
                    <div class="progress-item">
                        <div class="progress-label">Trial</div>
                        <div class="progress-value" id="currentTrial">0</div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-label">Accuracy</div>
                        <div class="progress-value" id="currentAccuracy">-</div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-info">
                    <div class="progress-item">
                        <div class="progress-label">Avg Time</div>
                        <div class="progress-value" id="avgTime">-</div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-label">Score</div>
                        <div class="progress-value" id="currentScore">0</div>
                    </div>
                </div>
            </div>

            <div class="stimulus-container">
                <div class="stimulus-word" id="stimulusWord">READY</div>
            </div>

            <div class="response-buttons" id="responseButtons">
                <button class="color-btn red" data-color="red">RED</button>
                <button class="color-btn blue" data-color="blue">BLUE</button>
                <button class="color-btn green" data-color="green">GREEN</button>
                <button class="color-btn yellow" data-color="yellow">YELLOW</button>
                <button class="color-btn purple" data-color="purple">PURPLE</button>
                <button class="color-btn orange" data-color="orange">ORANGE</button>
            </div>

            <div class="message-display waiting" id="messageDisplay">
                Click START to begin your cognitive control assessment
            </div>

            <div class="controls">
                <button class="control-btn" id="startBtn">Start Test</button>
                <button class="control-btn pause" id="pauseBtn" disabled>Pause</button>
                <button class="control-btn" id="resetBtn">Reset</button>
            </div>
        </div>

        <div class="results-container" id="resultsContainer">
            <div class="results-header">
                <h2>Cognitive Control Analysis</h2>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="overallAccuracy">-</div>
                    <div class="stat-label">Overall Accuracy</div>
                    <div class="performance-indicator" id="accuracyPerformance">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgReactionTime">-</div>
                    <div class="stat-label">Avg Reaction (ms)</div>
                    <div class="performance-indicator" id="reactionPerformance">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stroopEffect">-</div>
                    <div class="stat-label">Stroop Effect (ms)</div>
                    <div class="performance-indicator" id="stroopPerformance">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="cognitiveControl">-</div>
                    <div class="stat-label">Control Score</div>
                    <div class="performance-indicator" id="controlPerformance">-</div>
                </div>
            </div>

            <div class="stroop-analysis">
                <div class="analysis-header">Interference Analysis</div>
                <div class="interference-comparison">
                    <div class="interference-card">
                        <div class="interference-title">Congruent Trials</div>
                        <div class="interference-value" id="congruentTime">-</div>
                        <div class="interference-change" id="congruentAccuracy">- accuracy</div>
                    </div>
                    <div class="interference-card">
                        <div class="interference-title">Incongruent Trials</div>
                        <div class="interference-value" id="incongruentTime">-</div>
                        <div class="interference-change" id="incongruentAccuracy">- accuracy</div>
                    </div>
                    <div class="interference-card">
                        <div class="interference-title">Interference Effect</div>
                        <div class="interference-value" id="interferenceEffect">-</div>
                        <div class="interference-change">Time difference</div>
                    </div>
                </div>
                <p style="color: var(--color-light-grey); font-size: 0.9rem;">
                    Lower interference effect indicates better cognitive control and resistance to automatic responses.
                </p>
            </div>

            <div class="trial-history">
                <div class="history-header">Trial Results</div>
                <div class="trial-grid" id="trialGrid">
                    <div style="color: var(--color-light-grey); font-style: italic; grid-column: 1 / -1; text-align: center; padding: 20px;">
                        No trials completed yet
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class StroopTest {
            constructor() {
                this.mode = 'classic';
                this.isActive = false;
                this.isPaused = false;
                this.currentTrial = 0;
                this.totalTrials = 40;
                this.stimulusDuration = 2000; // ms
                this.isiDuration = 500; // Inter-stimulus interval
                
                this.trials = [];
                this.responses = [];
                this.trialResults = [];
                this.reactionTimes = [];
                
                this.correctResponses = 0;
                this.congruentTrials = [];
                this.incongruentTrials = [];
                
                this.stimulusStartTime = 0;
                this.currentStimulus = null;
                
                // Color mappings
                this.colors = {
                    classic: ['red', 'blue', 'green', 'yellow', 'purple', 'orange'],
                    emotional: ['red', 'blue', 'green', 'yellow'],
                    numerical: ['red', 'blue', 'green', 'yellow'],
                    spatial: ['red', 'blue', 'green', 'yellow']
                };
                
                this.words = {
                    classic: ['RED', 'BLUE', 'GREEN', 'YELLOW', 'PURPLE', 'ORANGE'],
                    emotional: ['HAPPY', 'SAD', 'ANGRY', 'CALM', 'EXCITED', 'WORRIED'],
                    numerical: ['ONE', 'TWO', 'THREE', 'FOUR', 'FIVE', 'SIX'],
                    spatial: ['LEFT', 'RIGHT', 'UP', 'DOWN', 'CENTER', 'CORNER']
                };
                
                this.initElements();
                this.setupEventListeners();
                this.updateDisplay();
                this.updateInstructions();
            }

            initElements() {
                this.stimulusWord = document.getElementById('stimulusWord');
                this.messageDisplay = document.getElementById('messageDisplay');
                this.startBtn = document.getElementById('startBtn');
                this.pauseBtn = document.getElementById('pauseBtn');
                this.resetBtn = document.getElementById('resetBtn');
                this.responseButtons = document.querySelectorAll('.color-btn');
                
                this.currentTrialDisplay = document.getElementById('currentTrial');
                this.currentAccuracyDisplay = document.getElementById('currentAccuracy');
                this.avgTimeDisplay = document.getElementById('avgTime');
                this.currentScoreDisplay = document.getElementById('currentScore');
                this.progressFill = document.getElementById('progressFill');
                
                this.instructions = document.getElementById('instructions');
                this.testModeDisplay = document.getElementById('testMode');
                this.totalTrialsDisplay = document.getElementById('totalTrials');
                this.trialSpeedDisplay = document.getElementById('trialSpeed');
                this.interferenceLevelDisplay = document.getElementById('interferenceLevel');
            }

            setupEventListeners() {
                // Mode selection
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        if (this.isActive) return;
                        
                        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        
                        this.mode = e.target.dataset.mode;
                        this.updateDisplay();
                        this.updateInstructions();
                        this.updateResponseButtons();
                    });
                });

                // Control buttons
                this.startBtn.addEventListener('click', () => this.startTest());
                this.pauseBtn.addEventListener('click', () => this.pauseTest());
                this.resetBtn.addEventListener('click', () => this.resetTest());

                // Response buttons
                this.responseButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.recordResponse(e.target.dataset.color);
                        this.animateButtonPress(e.target);
                    });
                });

                // Keyboard events
                document.addEventListener('keydown', (e) => {
                    if (!this.isActive || this.isPaused) return;
                    
                    const keyMap = {
                        'KeyR': 'red',
                        'KeyB': 'blue',
                        'KeyG': 'green',
                        'KeyY': 'yellow',
                        'KeyP': 'purple',
                        'KeyO': 'orange'
                    };
                    
                    if (keyMap[e.code]) {
                        e.preventDefault();
                        this.recordResponse(keyMap[e.code]);
                        
                        // Animate corresponding button
                        const btn = document.querySelector(`[data-color="${keyMap[e.code]}"]`);
                        if (btn) this.animateButtonPress(btn);
                    }
                });
            }

            updateDisplay() {
                this.testModeDisplay.textContent = this.mode.charAt(0).toUpperCase() + this.mode.slice(1);
                this.totalTrialsDisplay.textContent = this.totalTrials;
                this.trialSpeedDisplay.textContent = `${this.stimulusDuration / 1000}s`;
                this.interferenceLevelDisplay.textContent = '50%'; // 50% incongruent trials
            }

            updateInstructions() {
                const instructions = {
                    classic: {
                        title: 'Classic Stroop Test',
                        text: 'Identify the <strong>COLOR</strong> of each word, not what the word says. Ignore the word meaning and focus only on the color.',
                        keys: 'Use the color buttons below or keyboard shortcuts: <span class="key-hint">R</span> Red, <span class="key-hint">B</span> Blue, <span class="key-hint">G</span> Green, <span class="key-hint">Y</span> Yellow'
                    },
                    emotional: {
                        title: 'Emotional Stroop Test',
                        text: 'Identify the <strong>COLOR</strong> of each emotional word. Don\'t let the emotion interfere with color identification.',
                        keys: 'Use the color buttons below or keyboard shortcuts: <span class="key-hint">R</span> Red, <span class="key-hint">B</span> Blue, <span class="key-hint">G</span> Green, <span class="key-hint">Y</span> Yellow'
                    },
                    numerical: {
                        title: 'Numerical Stroop Test',
                        text: 'Identify the <strong>COLOR</strong> of each number word. Ignore the numerical meaning and focus on the color.',
                        keys: 'Use the color buttons below or keyboard shortcuts: <span class="key-hint">R</span> Red, <span class="key-hint">B</span> Blue, <span class="key-hint">G</span> Green, <span class="key-hint">Y</span> Yellow'
                    },
                    spatial: {
                        title: 'Spatial Stroop Test',
                        text: 'Identify the <strong>COLOR</strong> of each spatial word. Don\'t let the spatial meaning interfere with color identification.',
                        keys: 'Use the color buttons below or keyboard shortcuts: <span class="key-hint">R</span> Red, <span class="key-hint">B</span> Blue, <span class="key-hint">G</span> Green, <span class="key-hint">Y</span> Yellow'
                    }
                };

                const instruction = instructions[this.mode] || instructions.classic;
                this.instructions.innerHTML = `
                    <h3>${instruction.title}</h3>
                    <p>${instruction.text}</p>
                    <p>${instruction.keys}</p>
                `;
            }

            updateResponseButtons() {
                const activeColors = this.colors[this.mode] || this.colors.classic;
                
                this.responseButtons.forEach(btn => {
                    const color = btn.dataset.color;
                    if (activeColors.includes(color)) {
                        btn.style.display = 'block';
                    } else {
                        btn.style.display = 'none';
                    }
                });
            }

            animateButtonPress(button) {
                button.classList.add('pressed');
                setTimeout(() => button.classList.remove('pressed'), 150);
            }

            async startTest() {
                if (this.isActive) return;
                
                this.isActive = true;
                this.isPaused = false;
                this.currentTrial = 0;
                this.trials = [];
                this.responses = [];
                this.trialResults = [];
                this.reactionTimes = [];
                this.correctResponses = 0;
                this.congruentTrials = [];
                this.incongruentTrials = [];
                
                this.startBtn.disabled = true;
                this.pauseBtn.disabled = false;
                this.messageDisplay.textContent = 'Get ready...';
                this.messageDisplay.className = 'message-display waiting';

                // Generate trial sequence
                this.generateTrials();

                // Countdown
                await this.showCountdown();
                
                if (this.isActive) {
                    this.messageDisplay.textContent = 'Focus on the COLOR, ignore the word!';
                    this.messageDisplay.className = 'message-display active';
                    this.runTrial();
                }
            }

            generateTrials() {
                const colors = this.colors[this.mode];
                const words = this.words[this.mode];
                
                // Generate congruent and incongruent trials
                const congruentCount = Math.floor(this.totalTrials * 0.5);
                const incongruentCount = this.totalTrials - congruentCount;
                
                // Congruent trials (word matches color)
                for (let i = 0; i < congruentCount; i++) {
                    const colorIndex = Math.floor(Math.random() * colors.length);
                    let word;
                    
                    if (this.mode === 'classic') {
                        word = words[colorIndex]; // Same color and word
                    } else {
                        word = words[Math.floor(Math.random() * words.length)]; // Random word
                    }
                    
                    this.trials.push({
                        word: word,
                        color: colors[colorIndex],
                        correctAnswer: colors[colorIndex],
                        isCongruent: this.mode === 'classic' ? true : Math.random() > 0.5
                    });
                }
                
                // Incongruent trials (word doesn't match color)
                for (let i = 0; i < incongruentCount; i++) {
                    const colorIndex = Math.floor(Math.random() * colors.length);
                    let wordIndex;
                    
                    if (this.mode === 'classic') {
                        // Ensure word doesn't match color
                        do {
                            wordIndex = Math.floor(Math.random() * words.length);
                        } while (wordIndex === colorIndex);
                    } else {
                        wordIndex = Math.floor(Math.random() * words.length);
                    }
                    
                    this.trials.push({
                        word: words[wordIndex],
                        color: colors[colorIndex],
                        correctAnswer: colors[colorIndex],
                        isCongruent: false
                    });
                }
                
                // Shuffle trials
                this.shuffleArray(this.trials);
            }

            shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            async showCountdown() {
                const countdown = document.createElement('div');
                countdown.className = 'countdown';
                this.messageDisplay.appendChild(countdown);
                
                for (let i = 3; i > 0; i--) {
                    countdown.textContent = i;
                    await this.delay(1000);
                    if (!this.isActive) return;
                }
                
                countdown.remove();
            }

            async runTrial() {
                if (!this.isActive || this.isPaused) return;
                
                if (this.currentTrial >= this.totalTrials) {
                    this.endTest();
                    return;
                }

                const trial = this.trials[this.currentTrial];
                this.currentStimulus = trial;
                this.currentTrial++;
                this.updateProgress();
                
                // Show stimulus
                this.stimulusStartTime = performance.now();
                await this.showStimulus(trial);
                
                // ISI (Inter-Stimulus Interval)
                await this.delay(this.isiDuration);
                
                // Check for response timeout
                this.checkTimeout();
                
                // Continue to next trial
                if (this.isActive) {
                    this.runTrial();
                }
            }

            async showStimulus(trial) {
                // Set word and color
                this.stimulusWord.textContent = trial.word;
                this.stimulusWord.style.color = `var(--color-${trial.color})`;
                this.stimulusWord.classList.add('active');
                
                await this.delay(this.stimulusDuration);
                
                // Clear stimulus
                this.stimulusWord.classList.remove('active');
                this.stimulusWord.textContent = '';
            }

            recordResponse(selectedColor) {
                if (!this.isActive || !this.currentStimulus) return;
                
                const reactionTime = performance.now() - this.stimulusStartTime;
                const isCorrect = selectedColor === this.currentStimulus.correctAnswer;
                
                this.responses.push({
                    trial: this.currentTrial,
                    response: selectedColor,
                    correct: isCorrect,
                    reactionTime: reactionTime,
                    stimulus: this.currentStimulus
                });

                this.reactionTimes.push(reactionTime);
                
                // Update statistics
                if (isCorrect) {
                    this.correctResponses++;
                    this.stimulusWord.classList.add('correct');
                } else {
                    this.stimulusWord.classList.add('incorrect');
                }
                
                // Categorize by congruency
                if (this.currentStimulus.isCongruent) {
                    this.congruentTrials.push({
                        correct: isCorrect,
                        reactionTime: reactionTime
                    });
                } else {
                    this.incongruentTrials.push({
                        correct: isCorrect,
                        reactionTime: reactionTime
                    });
                }

                // Record trial result
                this.trialResults.push({
                    correct: isCorrect,
                    response: selectedColor,
                    expected: this.currentStimulus.correctAnswer,
                    reactionTime: reactionTime,
                    isCongruent: this.currentStimulus.isCongruent,
                    word: this.currentStimulus.word,
                    color: this.currentStimulus.color
                });

                this.updateTrialHistory();
                this.currentStimulus = null;
                
                // Clear visual feedback
                setTimeout(() => {
                    this.stimulusWord.classList.remove('correct', 'incorrect');
                }, 300);
            }

            checkTimeout() {
                // If no response was recorded for this trial, count it as incorrect
                if (this.responses.length < this.currentTrial && this.currentStimulus) {
                    this.responses.push({
                        trial: this.currentTrial,
                        response: null,
                        correct: false,
                        reactionTime: null,
                        stimulus: this.currentStimulus
                    });

                    // Categorize by congruency
                    if (this.currentStimulus.isCongruent) {
                        this.congruentTrials.push({
                            correct: false,
                            reactionTime: this.stimulusDuration
                        });
                    } else {
                        this.incongruentTrials.push({
                            correct: false,
                            reactionTime: this.stimulusDuration
                        });
                    }

                    this.trialResults.push({
                        correct: false,
                        response: null,
                        expected: this.currentStimulus.correctAnswer,
                        reactionTime: null,
                        isCongruent: this.currentStimulus.isCongruent,
                        word: this.currentStimulus.word,
                        color: this.currentStimulus.color
                    });

                    this.updateTrialHistory();
                    this.currentStimulus = null;
                }
            }

            updateProgress() {
                this.currentTrialDisplay.textContent = this.currentTrial;
                
                const accuracy = this.currentTrial > 0 ? 
                    Math.round((this.correctResponses / this.responses.length) * 100) : 0;
                this.currentAccuracyDisplay.textContent = `${accuracy}%`;
                
                const avgTime = this.reactionTimes.length > 0 ? 
                    Math.round(this.reactionTimes.reduce((a, b) => a + b, 0) / this.reactionTimes.length) : 0;
                this.avgTimeDisplay.textContent = `${avgTime}ms`;
                
                const score = this.calculateScore();
                this.currentScoreDisplay.textContent = score;
                
                const progress = (this.currentTrial / this.totalTrials) * 100;
                this.progressFill.style.width = `${progress}%`;
            }

            updateTrialHistory() {
                const trialGrid = document.getElementById('trialGrid');
                trialGrid.innerHTML = '';

                this.trialResults.forEach((result, index) => {
                    const trial = document.createElement('div');
                    trial.className = 'trial-result';
                    trial.textContent = index + 1;
                    
                    if (result.correct) {
                        trial.classList.add('correct');
                    } else {
                        trial.classList.add('incorrect');
                    }
                    
                    if (result.isCongruent) {
                        trial.classList.add('congruent');
                    } else {
                        trial.classList.add('incongruent');
                    }
                    
                    trial.title = `Trial ${index + 1}: "${result.word}" in ${result.color}
                        ${result.correct ? 'Correct' : 'Incorrect'} 
                        ${result.reactionTime ? `(${Math.round(result.reactionTime)}ms)` : '(No response)'}
                        ${result.isCongruent ? 'Congruent' : 'Incongruent'}`;
                    
                    trialGrid.appendChild(trial);
                });
            }

            calculateScore() {
                if (this.responses.length === 0) return 0;
                
                const accuracy = this.correctResponses / this.responses.length;
                const avgReactionTime = this.reactionTimes.length > 0 ? 
                    this.reactionTimes.reduce((a, b) => a + b, 0) / this.reactionTimes.length : 2000;
                
                // Score formula: accuracy weighted by speed and stroop effect resistance
                const speedBonus = Math.max(0, (2000 - avgReactionTime) / 2000);
                const stroopEffect = this.calculateStroopEffect();
                const resistanceBonus = Math.max(0, (200 - stroopEffect) / 200);
                
                return Math.round(accuracy * 100 * (1 + speedBonus * 0.3 + resistanceBonus * 0.2));
            }

            calculateStroopEffect() {
                if (this.congruentTrials.length === 0 || this.incongruentTrials.length === 0) return 0;
                
                const congruentAvg = this.congruentTrials
                    .filter(t => t.reactionTime)
                    .reduce((sum, t) => sum + t.reactionTime, 0) / 
                    this.congruentTrials.filter(t => t.reactionTime).length;
                
                const incongruentAvg = this.incongruentTrials
                    .filter(t => t.reactionTime)
                    .reduce((sum, t) => sum + t.reactionTime, 0) / 
                    this.incongruentTrials.filter(t => t.reactionTime).length;
                
                return incongruentAvg - congruentAvg;
            }

            pauseTest() {
                if (!this.isActive) return;
                
                this.isPaused = !this.isPaused;
                this.pauseBtn.textContent = this.isPaused ? 'Resume' : 'Pause';
                
                if (this.isPaused) {
                    this.messageDisplay.textContent = 'Test Paused - Click Resume to continue';
                    this.messageDisplay.className = 'message-display waiting';
                } else {
                    this.messageDisplay.textContent = 'Focus on the COLOR, ignore the word!';
                    this.messageDisplay.className = 'message-display active';
                    this.runTrial();
                }
            }

            resetTest() {
                this.isActive = false;
                this.isPaused = false;
                this.currentTrial = 0;
                this.trials = [];
                this.responses = [];
                this.trialResults = [];
                this.reactionTimes = [];
                this.correctResponses = 0;
                this.congruentTrials = [];
                this.incongruentTrials = [];
                this.currentStimulus = null;
                
                this.startBtn.disabled = false;
                this.pauseBtn.disabled = true;
                this.pauseBtn.textContent = 'Pause';
                
                this.messageDisplay.textContent = 'Click START to begin your cognitive control assessment';
                this.messageDisplay.className = 'message-display waiting';
                
                this.stimulusWord.textContent = 'READY';
                this.stimulusWord.style.color = 'var(--color-accent)';
                this.stimulusWord.classList.remove('active', 'correct', 'incorrect');
                
                this.updateProgress();
                this.updateResults();
            }

            endTest() {
                this.isActive = false;
                this.isPaused = false;
                this.startBtn.disabled = false;
                this.pauseBtn.disabled = true;
                
                this.messageDisplay.textContent = 'Test Complete! Check your cognitive control analysis below.';
                this.messageDisplay.className = 'message-display complete';
                
                this.stimulusWord.textContent = 'COMPLETE';
                this.stimulusWord.style.color = 'var(--color-accent)';
                this.stimulusWord.classList.remove('active', 'correct', 'incorrect');
                
                this.updateResults();
            }

            updateResults() {
                if (this.trialResults.length === 0) {
                    // Reset display
                    document.getElementById('overallAccuracy').textContent = '-';
                    document.getElementById('avgReactionTime').textContent = '-';
                    document.getElementById('stroopEffect').textContent = '-';
                    document.getElementById('cognitiveControl').textContent = '-';
                    return;
                }

                const accuracy = (this.correctResponses / this.trialResults.length) * 100;
                const avgReactionTime = this.reactionTimes.length > 0 ? 
                    this.reactionTimes.reduce((a, b) => a + b, 0) / this.reactionTimes.length : 0;
                const stroopEffect = this.calculateStroopEffect();
                const controlScore = this.calculateScore();

                document.getElementById('overallAccuracy').textContent = `${Math.round(accuracy)}%`;
                document.getElementById('avgReactionTime').textContent = Math.round(avgReactionTime);
                document.getElementById('stroopEffect').textContent = Math.round(stroopEffect);
                document.getElementById('cognitiveControl').textContent = controlScore;

                // Performance indicators
                this.updatePerformanceIndicator('accuracyPerformance', accuracy, [90, 80, 70]);
                this.updatePerformanceIndicator('reactionPerformance', avgReactionTime, [800, 1200, 1600], true);
                this.updatePerformanceIndicator('stroopPerformance', stroopEffect, [50, 100, 150], true);
                this.updatePerformanceIndicator('controlPerformance', controlScore, [80, 60, 40]);

                // Update interference analysis
                this.updateInterferenceAnalysis();
            }

            updateInterferenceAnalysis() {
                if (this.congruentTrials.length === 0 || this.incongruentTrials.length === 0) return;
                
                const congruentCorrect = this.congruentTrials.filter(t => t.correct);
                const incongruentCorrect = this.incongruentTrials.filter(t => t.correct);
                
                const congruentTime = congruentCorrect.length > 0 ? 
                    congruentCorrect.reduce((sum, t) => sum + t.reactionTime, 0) / congruentCorrect.length : 0;
                const incongruentTime = incongruentCorrect.length > 0 ? 
                    incongruentCorrect.reduce((sum, t) => sum + t.reactionTime, 0) / incongruentCorrect.length : 0;
                
                const congruentAccuracy = (congruentCorrect.length / this.congruentTrials.length) * 100;
                const incongruentAccuracy = (incongruentCorrect.length / this.incongruentTrials.length) * 100;
                
                document.getElementById('congruentTime').textContent = `${Math.round(congruentTime)}ms`;
                document.getElementById('congruentAccuracy').textContent = `${Math.round(congruentAccuracy)}% accuracy`;
                document.getElementById('incongruentTime').textContent = `${Math.round(incongruentTime)}ms`;
                document.getElementById('incongruentAccuracy').textContent = `${Math.round(incongruentAccuracy)}% accuracy`;
                document.getElementById('interferenceEffect').textContent = `+${Math.round(incongruentTime - congruentTime)}ms`;
            }

            updatePerformanceIndicator(elementId, value, thresholds, reverse = false) {
                const element = document.getElementById(elementId);
                let performance, className;

                if (reverse) {
                    // Lower is better
                    if (value < thresholds[0]) {
                        performance = 'Excellent';
                        className = 'excellent';
                    } else if (value < thresholds[1]) {
                        performance = 'Good';
                        className = 'good';
                    } else if (value < thresholds[2]) {
                        performance = 'Average';
                        className = 'average';
                    } else {
                        performance = 'Poor';
                        className = 'poor';
                    }
                } else {
                    // Higher is better
                    if (value >= thresholds[0]) {
                        performance = 'Excellent';
                        className = 'excellent';
                    } else if (value >= thresholds[1]) {
                        performance = 'Good';
                        className = 'good';
                    } else if (value >= thresholds[2]) {
                        performance = 'Average';
                        className = 'average';
                    } else {
                        performance = 'Poor';
                        className = 'poor';
                    }
                }

                element.textContent = performance;
                element.className = `performance-indicator ${className}`;
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // Initialize the test when the page loads
        window.addEventListener('load', () => {
            new StroopTest();
        });
    </script>
</body>
</html>