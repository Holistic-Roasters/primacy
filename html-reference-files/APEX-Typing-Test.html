<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APEX: Typing Speed & Accuracy Assessment</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@700&family=Roboto:wght@400;500&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --color-black: #080808;
            --color-dark-grey: #1a1a1a;
            --color-mid-grey: #2e2e2e;
            --color-light-grey: #888888;
            --color-white: #f5f5f5;
            --color-accent: #00ff9d;
            --color-warning: #ff6b6b;
            --color-excellent: #00ff9d;
            --color-good: #ffcc00;
            --color-average: #ff9966;
            --color-poor: #ff6b6b;
            --color-correct: #00ff9d;
            --color-incorrect: #ff6b6b;
            --color-current: #ffffff;
            --color-pending: #555555;
            --font-primary: 'Roboto', sans-serif;
            --font-display: 'Roboto Condensed', sans-serif;
            --font-mono: 'Roboto Mono', monospace;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--color-black);
            font-family: var(--font-primary);
            color: var(--color-white);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
        }

        .container {
            width: 90%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 0;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .header h1 {
            font-family: var(--font-display);
            font-size: 3rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, var(--color-accent), var(--color-white));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.2rem;
            color: var(--color-light-grey);
            max-width: 700px;
            margin: 0 auto;
        }

        .test-container {
            background: var(--color-dark-grey);
            border-radius: 20px;
            padding: 2rem;
            position: relative;
            box-shadow: 0 0 50px rgba(0, 255, 157, 0.1);
            margin-bottom: 2rem;
        }

        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .mode-btn {
            background: var(--color-black);
            border: 2px solid var(--color-mid-grey);
            color: var(--color-light-grey);
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
            font-weight: 500;
            position: relative;
        }

        .mode-btn:hover {
            border-color: var(--color-accent);
            color: var(--color-accent);
        }

        .mode-btn.active {
            background: var(--color-accent);
            color: var(--color-black);
            border-color: var(--color-accent);
        }

        .mode-description {
            display: block;
            font-size: 0.7rem;
            opacity: 0.8;
            margin-top: 3px;
            font-weight: normal;
        }

        .test-config {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .config-item {
            text-align: center;
        }

        .config-label {
            color: var(--color-accent);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .config-value {
            font-family: var(--font-display);
            font-size: 1.5rem;
            color: var(--color-white);
        }

        .live-stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 2rem;
            padding: 20px;
            background: var(--color-black);
            border-radius: 15px;
            border: 2px solid var(--color-mid-grey);
        }

        .live-stat {
            text-align: center;
        }

        .live-stat-value {
            font-family: var(--font-display);
            font-size: 2.5rem;
            color: var(--color-accent);
            margin-bottom: 5px;
            transition: all 0.3s ease;
        }

        .live-stat-label {
            color: var(--color-light-grey);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .timer-container {
            text-align: center;
            margin-bottom: 2rem;
        }

        .timer {
            font-family: var(--font-display);
            font-size: 3rem;
            color: var(--color-accent);
            margin-bottom: 10px;
            text-shadow: 0 0 20px var(--color-accent);
        }

        .timer.warning {
            color: var(--color-warning);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--color-mid-grey);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--color-accent), var(--color-white));
            border-radius: 4px;
            width: 0%;
            transition: width 0.3s ease;
        }

        .typing-area {
            background: var(--color-black);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 2rem;
            border: 2px solid var(--color-mid-grey);
            position: relative;
        }

        .text-display {
            font-family: var(--font-mono);
            font-size: 1.3rem;
            line-height: 1.8;
            margin-bottom: 20px;
            padding: 20px;
            background: var(--color-mid-grey);
            border-radius: 10px;
            min-height: 120px;
            user-select: none;
            position: relative;
        }

        .text-char {
            position: relative;
            transition: all 0.1s ease;
        }

        .text-char.correct {
            background-color: rgba(0, 255, 157, 0.2);
            color: var(--color-correct);
        }

        .text-char.incorrect {
            background-color: rgba(255, 107, 107, 0.2);
            color: var(--color-incorrect);
        }

        .text-char.current {
            background-color: var(--color-accent);
            color: var(--color-black);
            animation: blink 1s infinite;
        }

        .text-char.pending {
            color: var(--color-pending);
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .typing-input {
            width: 100%;
            padding: 15px 20px;
            font-family: var(--font-mono);
            font-size: 1.2rem;
            background: var(--color-dark-grey);
            border: 2px solid var(--color-mid-grey);
            border-radius: 10px;
            color: var(--color-white);
            outline: none;
            transition: all 0.3s ease;
        }

        .typing-input:focus {
            border-color: var(--color-accent);
            box-shadow: 0 0 15px rgba(0, 255, 157, 0.3);
        }

        .typing-input:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .control-btn {
            background: var(--color-accent);
            color: var(--color-black);
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .control-btn:hover {
            background: var(--color-white);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 157, 0.3);
        }

        .control-btn:disabled {
            background: var(--color-mid-grey);
            color: var(--color-light-grey);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .control-btn.restart {
            background: var(--color-warning);
        }

        .message-display {
            text-align: center;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 2rem;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .message-display.waiting {
            background: rgba(255, 107, 107, 0.1);
            color: var(--color-warning);
            border: 2px solid var(--color-warning);
        }

        .message-display.active {
            background: rgba(0, 255, 157, 0.1);
            color: var(--color-accent);
            border: 2px solid var(--color-accent);
        }

        .message-display.complete {
            background: rgba(255, 255, 255, 0.1);
            color: var(--color-white);
            border: 2px solid var(--color-white);
        }

        .results-container {
            background: var(--color-dark-grey);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 0 50px rgba(0, 255, 157, 0.1);
        }

        .results-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .results-header h2 {
            font-family: var(--font-display);
            font-size: 2rem;
            color: var(--color-accent);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--color-black);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid var(--color-mid-grey);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: var(--color-accent);
            transform: translateY(-2px);
        }

        .stat-value {
            font-family: var(--font-display);
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--color-light-grey);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
        }

        .performance-indicator {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 10px;
        }

        .excellent { 
            background: var(--color-excellent); 
            color: var(--color-black); 
        }
        .good { 
            background: var(--color-good); 
            color: var(--color-black); 
        }
        .average { 
            background: var(--color-average); 
            color: var(--color-black); 
        }
        .poor { 
            background: var(--color-poor); 
            color: var(--color-white); 
        }

        .typing-analysis {
            background: var(--color-black);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        .analysis-header {
            color: var(--color-accent);
            font-family: var(--font-display);
            font-size: 1.3rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
        }

        .error-analysis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .error-card {
            background: var(--color-mid-grey);
            padding: 15px;
            border-radius: 10px;
        }

        .error-title {
            color: var(--color-accent);
            font-weight: bold;
            margin-bottom: 10px;
            text-transform: uppercase;
            font-size: 0.9rem;
        }

        .error-list {
            font-family: var(--font-mono);
            font-size: 0.9rem;
            color: var(--color-light-grey);
        }

        .keystroke-heatmap {
            background: var(--color-black);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        .heatmap-header {
            color: var(--color-accent);
            font-family: var(--font-display);
            font-size: 1.3rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
            text-align: center;
        }

        .keyboard-layout {
            display: grid;
            gap: 5px;
            max-width: 800px;
            margin: 0 auto;
        }

        .keyboard-row {
            display: grid;
            gap: 5px;
            justify-content: center;
        }

        .keyboard-row:nth-child(1) { grid-template-columns: repeat(10, 1fr); }
        .keyboard-row:nth-child(2) { grid-template-columns: repeat(10, 1fr); }
        .keyboard-row:nth-child(3) { grid-template-columns: repeat(9, 1fr); }
        .keyboard-row:nth-child(4) { grid-template-columns: 2fr repeat(7, 1fr) 2fr; }

        .key {
            background: var(--color-mid-grey);
            border: 1px solid var(--color-light-grey);
            border-radius: 5px;
            padding: 10px 5px;
            text-align: center;
            font-family: var(--font-mono);
            font-size: 0.8rem;
            color: var(--color-white);
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .key.error-1 { background: rgba(255, 107, 107, 0.3); }
        .key.error-2 { background: rgba(255, 107, 107, 0.5); }
        .key.error-3 { background: rgba(255, 107, 107, 0.7); }
        .key.error-4 { background: rgba(255, 107, 107, 0.9); }

        .wpm-chart {
            background: var(--color-black);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        .chart-header {
            color: var(--color-accent);
            font-family: var(--font-display);
            font-size: 1.3rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
            text-align: center;
        }

        .chart-container {
            height: 200px;
            position: relative;
            border: 1px solid var(--color-mid-grey);
            border-radius: 8px;
            background: var(--color-mid-grey);
        }

        .chart-line {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            top: 0;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .live-stats {
                flex-direction: column;
                gap: 15px;
            }

            .text-display {
                font-size: 1.1rem;
                padding: 15px;
            }

            .typing-input {
                font-size: 1rem;
            }

            .mode-selector {
                flex-direction: column;
                align-items: center;
            }

            .mode-btn {
                width: 250px;
            }

            .test-config {
                flex-direction: column;
                gap: 15px;
            }

            .controls {
                flex-direction: column;
                align-items: center;
            }

            .control-btn {
                width: 200px;
            }

            .keyboard-layout {
                font-size: 0.7rem;
            }

            .key {
                min-height: 30px;
                font-size: 0.7rem;
            }
        }

        .hidden {
            display: none;
        }

        .countdown {
            font-family: var(--font-display);
            font-size: 4rem;
            color: var(--color-accent);
            text-align: center;
            text-shadow: 0 0 20px var(--color-accent);
            margin: 2rem 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>APEX TYPING</h1>
            <p>Measure your typing speed, accuracy, and consistency. Track improvements in words per minute and develop muscle memory for peak performance.</p>
        </div>

        <div class="test-container">
            <div class="mode-selector">
                <button class="mode-btn active" data-mode="standard" data-duration="60">
                    Standard Test
                    <span class="mode-description">60 seconds</span>
                </button>
                <button class="mode-btn" data-mode="quick" data-duration="30">
                    Quick Test
                    <span class="mode-description">30 seconds</span>
                </button>
                <button class="mode-btn" data-mode="endurance" data-duration="120">
                    Endurance Test
                    <span class="mode-description">2 minutes</span>
                </button>
                <button class="mode-btn" data-mode="sprint" data-duration="15">
                    Sprint Test
                    <span class="mode-description">15 seconds</span>
                </button>
            </div>

            <div class="test-config">
                <div class="config-item">
                    <div class="config-label">Duration</div>
                    <div class="config-value" id="testDuration">60s</div>
                </div>
                <div class="config-item">
                    <div class="config-label">Text Type</div>
                    <div class="config-value" id="textType">Mixed</div>
                </div>
                <div class="config-item">
                    <div class="config-label">Difficulty</div>
                    <div class="config-value" id="difficulty">Medium</div>
                </div>
                <div class="config-item">
                    <div class="config-label">Language</div>
                    <div class="config-value" id="language">English</div>
                </div>
            </div>

            <div class="live-stats">
                <div class="live-stat">
                    <div class="live-stat-value" id="liveWPM">0</div>
                    <div class="live-stat-label">WPM</div>
                </div>
                <div class="live-stat">
                    <div class="live-stat-value" id="liveAccuracy">100%</div>
                    <div class="live-stat-label">Accuracy</div>
                </div>
                <div class="live-stat">
                    <div class="live-stat-value" id="liveProgress">0%</div>
                    <div class="live-stat-label">Progress</div>
                </div>
                <div class="live-stat">
                    <div class="live-stat-value" id="liveErrors">0</div>
                    <div class="live-stat-label">Errors</div>
                </div>
            </div>

            <div class="timer-container">
                <div class="timer" id="timer">60</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>

            <div class="typing-area">
                <div class="text-display" id="textDisplay">
                    Click START to begin your typing assessment
                </div>
                <input type="text" class="typing-input" id="typingInput" placeholder="Type the text above..." disabled>
            </div>

            <div class="message-display waiting" id="messageDisplay">
                Click START to begin measuring your typing performance
            </div>

            <div class="controls">
                <button class="control-btn" id="startBtn">Start Test</button>
                <button class="control-btn restart" id="restartBtn" disabled>Restart</button>
                <button class="control-btn" id="resetBtn">Reset</button>
            </div>
        </div>

        <div class="results-container" id="resultsContainer">
            <div class="results-header">
                <h2>Typing Performance Analysis</h2>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="finalWPM">-</div>
                    <div class="stat-label">Words Per Minute</div>
                    <div class="performance-indicator" id="wpmPerformance">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="finalAccuracy">-</div>
                    <div class="stat-label">Accuracy</div>
                    <div class="performance-indicator" id="accuracyPerformance">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalErrors">0</div>
                    <div class="stat-label">Total Errors</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="consistency">-</div>
                    <div class="stat-label">Consistency</div>
                    <div class="performance-indicator" id="consistencyPerformance">-</div>
                </div>
            </div>

            <div class="wpm-chart">
                <div class="chart-header">WPM Over Time</div>
                <div class="chart-container" id="chartContainer">
                    <canvas id="wpmChart" width="800" height="200"></canvas>
                </div>
            </div>

            <div class="typing-analysis">
                <div class="analysis-header">Error Analysis</div>
                <div class="error-analysis">
                    <div class="error-card">
                        <div class="error-title">Most Missed Characters</div>
                        <div class="error-list" id="missedChars">No errors yet</div>
                    </div>
                    <div class="error-card">
                        <div class="error-title">Common Mistakes</div>
                        <div class="error-list" id="commonMistakes">No patterns detected</div>
                    </div>
                    <div class="error-card">
                        <div class="error-title">Typing Speed Trend</div>
                        <div class="error-list" id="speedTrend">Start typing to see trend</div>
                    </div>
                </div>
            </div>

            <div class="keystroke-heatmap">
                <div class="heatmap-header">Keystroke Error Heatmap</div>
                <div class="keyboard-layout" id="keyboardLayout">
                    <div class="keyboard-row">
                        <div class="key" data-key="1">1</div>
                        <div class="key" data-key="2">2</div>
                        <div class="key" data-key="3">3</div>
                        <div class="key" data-key="4">4</div>
                        <div class="key" data-key="5">5</div>
                        <div class="key" data-key="6">6</div>
                        <div class="key" data-key="7">7</div>
                        <div class="key" data-key="8">8</div>
                        <div class="key" data-key="9">9</div>
                        <div class="key" data-key="0">0</div>
                    </div>
                    <div class="keyboard-row">
                        <div class="key" data-key="q">Q</div>
                        <div class="key" data-key="w">W</div>
                        <div class="key" data-key="e">E</div>
                        <div class="key" data-key="r">R</div>
                        <div class="key" data-key="t">T</div>
                        <div class="key" data-key="y">Y</div>
                        <div class="key" data-key="u">U</div>
                        <div class="key" data-key="i">I</div>
                        <div class="key" data-key="o">O</div>
                        <div class="key" data-key="p">P</div>
                    </div>
                    <div class="keyboard-row">
                        <div class="key" data-key="a">A</div>
                        <div class="key" data-key="s">S</div>
                        <div class="key" data-key="d">D</div>
                        <div class="key" data-key="f">F</div>
                        <div class="key" data-key="g">G</div>
                        <div class="key" data-key="h">H</div>
                        <div class="key" data-key="j">J</div>
                        <div class="key" data-key="k">K</div>
                        <div class="key" data-key="l">L</div>
                    </div>
                    <div class="keyboard-row">
                        <div class="key" data-key="shift">Shift</div>
                        <div class="key" data-key="z">Z</div>
                        <div class="key" data-key="x">X</div>
                        <div class="key" data-key="c">C</div>
                        <div class="key" data-key="v">V</div>
                        <div class="key" data-key="b">B</div>
                        <div class="key" data-key="n">N</div>
                        <div class="key" data-key="m">M</div>
                        <div class="key" data-key="space">Space</div>
                    </div>
                </div>
                <p style="color: var(--color-light-grey); font-size: 0.9rem; text-align: center; margin-top: 15px;">
                    Red intensity indicates error frequency. Focus on the highlighted keys to improve accuracy.
                </p>
            </div>
        </div>
    </div>

    <script>
        class TypingTest {
            constructor() {
                this.mode = 'standard';
                this.duration = 60; // seconds
                this.isActive = false;
                this.isPaused = false;
                this.startTime = 0;
                this.endTime = 0;
                this.timeRemaining = this.duration;
                
                this.currentText = '';
                this.typedText = '';
                this.currentPosition = 0;
                this.errors = [];
                this.keystrokes = [];
                this.wpmHistory = [];
                this.errorsByKey = {};
                
                this.totalCharacters = 0;
                this.correctCharacters = 0;
                this.incorrectCharacters = 0;
                this.lastWpmCalculation = 0;
                
                this.timer = null;
                this.wpmInterval = null;
                
                this.textSamples = [
                    "The quick brown fox jumps over the lazy dog. This pangram contains every letter of the alphabet and is commonly used for typing practice.",
                    "In a hole in the ground there lived a hobbit. Not a nasty, dirty, wet hole, filled with the ends of worms and an oozy smell, nor yet a dry, bare, sandy hole.",
                    "It was the best of times, it was the worst of times, it was the age of wisdom, it was the age of foolishness, it was the epoch of belief.",
                    "To be or not to be, that is the question. Whether it is nobler in the mind to suffer the slings and arrows of outrageous fortune, or to take arms.",
                    "Call me Ishmael. Some years ago, never mind how long precisely, having little or no money in my purse, and nothing particular to interest me on shore.",
                    "Space, the final frontier. These are the voyages of the starship Enterprise. Its continuing mission, to explore strange new worlds, to seek out new life.",
                    "All human beings are born free and equal in dignity and rights. They are endowed with reason and conscience and should act towards one another.",
                    "The only way to do great work is to love what you do. If you haven't found it yet, keep looking. Don't settle. As with all matters of the heart, you'll know.",
                    "Innovation distinguishes between a leader and a follower. The desktop metaphor was revolutionary, but it's time to move beyond it to more natural interfaces.",
                    "Two roads diverged in a yellow wood, and sorry I could not travel both and be one traveler, long I stood and looked down one as far as I could."
                ];
                
                this.initElements();
                this.setupEventListeners();
                this.updateDisplay();
                this.generateText();
            }

            initElements() {
                this.textDisplay = document.getElementById('textDisplay');
                this.typingInput = document.getElementById('typingInput');
                this.timer = document.getElementById('timer');
                this.progressFill = document.getElementById('progressFill');
                
                this.liveWPM = document.getElementById('liveWPM');
                this.liveAccuracy = document.getElementById('liveAccuracy');
                this.liveProgress = document.getElementById('liveProgress');
                this.liveErrors = document.getElementById('liveErrors');
                
                this.messageDisplay = document.getElementById('messageDisplay');
                this.startBtn = document.getElementById('startBtn');
                this.restartBtn = document.getElementById('restartBtn');
                this.resetBtn = document.getElementById('resetBtn');
                
                this.testDurationDisplay = document.getElementById('testDuration');
                this.textTypeDisplay = document.getElementById('textType');
                this.difficultyDisplay = document.getElementById('difficulty');
                this.languageDisplay = document.getElementById('language');
                
                this.wpmChart = document.getElementById('wpmChart');
                this.chartContext = this.wpmChart.getContext('2d');
            }

            setupEventListeners() {
                // Mode selection
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        if (this.isActive) return;
                        
                        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        
                        this.mode = e.target.dataset.mode;
                        this.duration = parseInt(e.target.dataset.duration);
                        this.timeRemaining = this.duration;
                        this.updateDisplay();
                        this.generateText();
                    });
                });

                // Control buttons
                this.startBtn.addEventListener('click', () => this.startTest());
                this.restartBtn.addEventListener('click', () => this.restartTest());
                this.resetBtn.addEventListener('click', () => this.resetTest());

                // Typing input
                this.typingInput.addEventListener('input', (e) => this.handleTyping(e));
                this.typingInput.addEventListener('keydown', (e) => this.handleKeyDown(e));
                this.typingInput.addEventListener('paste', (e) => e.preventDefault());

                // Prevent context menu and other interruptions
                this.typingInput.addEventListener('contextmenu', (e) => e.preventDefault());
                
                // Focus management
                document.addEventListener('click', (e) => {
                    if (this.isActive && !e.target.closest('.controls')) {
                        this.typingInput.focus();
                    }
                });
            }

            updateDisplay() {
                this.testDurationDisplay.textContent = `${this.duration}s`;
                this.textTypeDisplay.textContent = 'Mixed';
                this.difficultyDisplay.textContent = 'Medium';
                this.languageDisplay.textContent = 'English';
                this.timer.textContent = this.timeRemaining;
            }

            generateText() {
                // Select multiple random samples and combine them
                const numSamples = Math.ceil(this.duration / 15); // More text for longer tests
                let combinedText = '';
                
                for (let i = 0; i < numSamples; i++) {
                    const randomIndex = Math.floor(Math.random() * this.textSamples.length);
                    combinedText += this.textSamples[randomIndex] + ' ';
                }
                
                this.currentText = combinedText.trim();
                this.displayText();
            }

            displayText() {
                this.textDisplay.innerHTML = '';
                
                for (let i = 0; i < this.currentText.length; i++) {
                    const span = document.createElement('span');
                    span.className = 'text-char';
                    span.textContent = this.currentText[i];
                    
                    if (i < this.currentPosition) {
                        if (this.typedText[i] === this.currentText[i]) {
                            span.classList.add('correct');
                        } else {
                            span.classList.add('incorrect');
                        }
                    } else if (i === this.currentPosition && this.isActive) {
                        span.classList.add('current');
                    } else {
                        span.classList.add('pending');
                    }
                    
                    this.textDisplay.appendChild(span);
                }
            }

            async startTest() {
                if (this.isActive) return;
                
                this.isActive = true;
                this.startTime = Date.now();
                this.timeRemaining = this.duration;
                this.currentPosition = 0;
                this.typedText = '';
                this.errors = [];
                this.keystrokes = [];
                this.wpmHistory = [];
                this.errorsByKey = {};
                this.totalCharacters = 0;
                this.correctCharacters = 0;
                this.incorrectCharacters = 0;
                
                this.startBtn.disabled = true;
                this.restartBtn.disabled = false;
                this.typingInput.disabled = false;
                this.typingInput.value = '';
                this.typingInput.focus();
                
                this.messageDisplay.textContent = 'Type the text above as accurately as possible!';
                this.messageDisplay.className = 'message-display active';
                
                this.displayText();
                this.startTimer();
                this.startWPMTracking();
            }

            startTimer() {
                this.timerInterval = setInterval(() => {
                    this.timeRemaining--;
                    this.timer.textContent = this.timeRemaining;
                    
                    if (this.timeRemaining <= 10) {
                        this.timer.classList.add('warning');
                    }
                    
                    const progress = ((this.duration - this.timeRemaining) / this.duration) * 100;
                    this.progressFill.style.width = `${progress}%`;
                    
                    if (this.timeRemaining <= 0) {
                        this.endTest();
                    }
                }, 1000);
            }

            startWPMTracking() {
                this.wpmInterval = setInterval(() => {
                    this.calculateLiveStats();
                }, 1000);
            }

            handleTyping(e) {
                if (!this.isActive) return;
                
                const inputValue = e.target.value;
                const lastChar = inputValue[inputValue.length - 1];
                
                // Handle backspace (input value is shorter)
                if (inputValue.length < this.typedText.length) {
                    this.handleBackspace();
                    return;
                }
                
                // Handle new character
                if (inputValue.length > this.typedText.length) {
                    this.handleNewCharacter(lastChar);
                }
            }

            handleNewCharacter(char) {
                const expectedChar = this.currentText[this.currentPosition];
                
                this.keystrokes.push({
                    char: char,
                    expected: expectedChar,
                    correct: char === expectedChar,
                    timestamp: Date.now() - this.startTime,
                    position: this.currentPosition
                });
                
                this.typedText += char;
                this.totalCharacters++;
                
                if (char === expectedChar) {
                    this.correctCharacters++;
                } else {
                    this.incorrectCharacters++;
                    this.errors.push({
                        position: this.currentPosition,
                        expected: expectedChar,
                        actual: char,
                        timestamp: Date.now() - this.startTime
                    });
                    
                    // Track errors by key
                    const key = expectedChar.toLowerCase();
                    this.errorsByKey[key] = (this.errorsByKey[key] || 0) + 1;
                }
                
                this.currentPosition++;
                this.displayText();
                this.calculateLiveStats();
                
                // Check if test is complete
                if (this.currentPosition >= this.currentText.length) {
                    this.endTest();
                }
            }

            handleBackspace() {
                if (this.currentPosition > 0) {
                    this.currentPosition--;
                    this.typedText = this.typedText.slice(0, -1);
                    this.typingInput.value = this.typedText;
                    this.displayText();
                    this.calculateLiveStats();
                }
            }

            handleKeyDown(e) {
                if (!this.isActive) return;
                
                // Prevent certain keys
                if (e.key === 'Tab' || e.key === 'Escape') {
                    e.preventDefault();
                }
            }

            calculateLiveStats() {
                const elapsedTime = (Date.now() - this.startTime) / 60000; // minutes
                const elapsedSeconds = (Date.now() - this.startTime) / 1000;
                
                // Calculate WPM (assuming average word length of 5 characters)
                const wordsTyped = this.correctCharacters / 5;
                const wpm = elapsedTime > 0 ? Math.round(wordsTyped / elapsedTime) : 0;
                
                // Calculate accuracy
                const accuracy = this.totalCharacters > 0 ? 
                    Math.round((this.correctCharacters / this.totalCharacters) * 100) : 100;
                
                // Calculate progress
                const progress = Math.round((this.currentPosition / this.currentText.length) * 100);
                
                // Update live stats
                this.liveWPM.textContent = wpm;
                this.liveAccuracy.textContent = `${accuracy}%`;
                this.liveProgress.textContent = `${progress}%`;
                this.liveErrors.textContent = this.errors.length;
                
                // Store WPM for chart
                if (elapsedSeconds >= this.lastWpmCalculation + 5) { // Every 5 seconds
                    this.wpmHistory.push({
                        time: elapsedSeconds,
                        wpm: wpm,
                        accuracy: accuracy
                    });
                    this.lastWpmCalculation = elapsedSeconds;
                }
            }

            restartTest() {
                this.endTest();
                this.resetTest();
                setTimeout(() => this.startTest(), 100);
            }

            resetTest() {
                this.endTest();
                
                this.currentPosition = 0;
                this.typedText = '';
                this.errors = [];
                this.keystrokes = [];
                this.wpmHistory = [];
                this.errorsByKey = {};
                this.totalCharacters = 0;
                this.correctCharacters = 0;
                this.incorrectCharacters = 0;
                this.timeRemaining = this.duration;
                
                this.startBtn.disabled = false;
                this.restartBtn.disabled = true;
                this.typingInput.disabled = true;
                this.typingInput.value = '';
                this.timer.classList.remove('warning');
                
                this.messageDisplay.textContent = 'Click START to begin measuring your typing performance';
                this.messageDisplay.className = 'message-display waiting';
                
                this.generateText();
                this.updateDisplay();
                this.updateResults();
                this.updateChart();
                this.updateKeyboardHeatmap();
            }

            endTest() {
                this.isActive = false;
                this.endTime = Date.now();
                
                clearInterval(this.timerInterval);
                clearInterval(this.wpmInterval);
                
                this.startBtn.disabled = false;
                this.restartBtn.disabled = true;
                this.typingInput.disabled = true;
                this.timer.classList.remove('warning');
                
                this.messageDisplay.textContent = 'Test Complete! Check your performance analysis below.';
                this.messageDisplay.className = 'message-display complete';
                
                this.updateResults();
                this.updateChart();
                this.updateErrorAnalysis();
                this.updateKeyboardHeatmap();
            }

            updateResults() {
                if (this.totalCharacters === 0) {
                    // Reset display
                    document.getElementById('finalWPM').textContent = '-';
                    document.getElementById('finalAccuracy').textContent = '-';
                    document.getElementById('totalErrors').textContent = '0';
                    document.getElementById('consistency').textContent = '-';
                    return;
                }

                const elapsedTime = this.endTime ? 
                    (this.endTime - this.startTime) / 60000 : 
                    (this.duration * 1000 - this.timeRemaining * 1000) / 60000;
                
                const wordsTyped = this.correctCharacters / 5;
                const wpm = elapsedTime > 0 ? Math.round(wordsTyped / elapsedTime) : 0;
                const accuracy = Math.round((this.correctCharacters / this.totalCharacters) * 100);
                const consistency = this.calculateConsistency();

                document.getElementById('finalWPM').textContent = wpm;
                document.getElementById('finalAccuracy').textContent = `${accuracy}%`;
                document.getElementById('totalErrors').textContent = this.errors.length;
                document.getElementById('consistency').textContent = `${consistency}%`;

                // Performance indicators
                this.updatePerformanceIndicator('wpmPerformance', wpm, [70, 50, 30]);
                this.updatePerformanceIndicator('accuracyPerformance', accuracy, [95, 90, 85]);
                this.updatePerformanceIndicator('consistencyPerformance', consistency, [90, 80, 70]);
            }

            calculateConsistency() {
                if (this.wpmHistory.length < 2) return 100;
                
                const wpmValues = this.wpmHistory.map(h => h.wpm);
                const average = wpmValues.reduce((a, b) => a + b, 0) / wpmValues.length;
                const variance = wpmValues.reduce((acc, wpm) => acc + Math.pow(wpm - average, 2), 0) / wpmValues.length;
                const stdDev = Math.sqrt(variance);
                
                // Convert to consistency percentage (lower variance = higher consistency)
                return Math.max(0, Math.round(100 - (stdDev / average) * 100));
            }

            updateChart() {
                const ctx = this.chartContext;
                const canvas = this.wpmChart;
                
                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                if (this.wpmHistory.length < 2) return;
                
                // Set up chart dimensions
                const padding = 40;
                const chartWidth = canvas.width - 2 * padding;
                const chartHeight = canvas.height - 2 * padding;
                
                // Find data ranges
                const maxWPM = Math.max(...this.wpmHistory.map(h => h.wpm));
                const maxTime = Math.max(...this.wpmHistory.map(h => h.time));
                
                // Draw grid
                ctx.strokeStyle = '#2e2e2e';
                ctx.lineWidth = 1;
                
                // Vertical grid lines
                for (let i = 0; i <= 5; i++) {
                    const x = padding + (chartWidth / 5) * i;
                    ctx.beginPath();
                    ctx.moveTo(x, padding);
                    ctx.lineTo(x, padding + chartHeight);
                    ctx.stroke();
                }
                
                // Horizontal grid lines
                for (let i = 0; i <= 4; i++) {
                    const y = padding + (chartHeight / 4) * i;
                    ctx.beginPath();
                    ctx.moveTo(padding, y);
                    ctx.lineTo(padding + chartWidth, y);
                    ctx.stroke();
                }
                
                // Draw WPM line
                ctx.strokeStyle = '#00ff9d';
                ctx.lineWidth = 3;
                ctx.beginPath();
                
                this.wpmHistory.forEach((point, index) => {
                    const x = padding + (point.time / maxTime) * chartWidth;
                    const y = padding + chartHeight - (point.wpm / (maxWPM + 10)) * chartHeight;
                    
                    if (index === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                
                ctx.stroke();
                
                // Draw points
                ctx.fillStyle = '#00ff9d';
                this.wpmHistory.forEach(point => {
                    const x = padding + (point.time / maxTime) * chartWidth;
                    const y = padding + chartHeight - (point.wpm / (maxWPM + 10)) * chartHeight;
                    
                    ctx.beginPath();
                    ctx.arc(x, y, 4, 0, Math.PI * 2);
                    ctx.fill();
                });
                
                // Draw labels
                ctx.fillStyle = '#888888';
                ctx.font = '12px Roboto';
                ctx.textAlign = 'center';
                
                // X-axis labels (time)
                for (let i = 0; i <= 5; i++) {
                    const x = padding + (chartWidth / 5) * i;
                    const time = (maxTime / 5) * i;
                    ctx.fillText(`${Math.round(time)}s`, x, canvas.height - 10);
                }
                
                // Y-axis labels (WPM)
                ctx.textAlign = 'right';
                for (let i = 0; i <= 4; i++) {
                    const y = padding + (chartHeight / 4) * i;
                    const wpm = (maxWPM + 10) - ((maxWPM + 10) / 4) * i;
                    ctx.fillText(`${Math.round(wpm)}`, padding - 10, y + 4);
                }
            }

            updateErrorAnalysis() {
                // Most missed characters
                const missedChars = Object.entries(this.errorsByKey)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5)
                    .map(([char, count]) => `'${char}': ${count} errors`)
                    .join('\n');
                
                document.getElementById('missedChars').textContent = 
                    missedChars || 'No errors detected';
                
                // Common mistakes (character substitutions)
                const mistakes = this.errors
                    .slice(0, 10)
                    .map(error => `'${error.expected}' → '${error.actual}'`)
                    .join('\n');
                
                document.getElementById('commonMistakes').textContent = 
                    mistakes || 'No common patterns';
                
                // Speed trend
                const trend = this.wpmHistory.length > 2 ? 
                    this.calculateTrend() : 'Need more data';
                
                document.getElementById('speedTrend').textContent = trend;
            }

            calculateTrend() {
                if (this.wpmHistory.length < 3) return 'Insufficient data';
                
                const recent = this.wpmHistory.slice(-3);
                const early = this.wpmHistory.slice(0, 3);
                
                const recentAvg = recent.reduce((sum, h) => sum + h.wpm, 0) / recent.length;
                const earlyAvg = early.reduce((sum, h) => sum + h.wpm, 0) / early.length;
                
                const difference = recentAvg - earlyAvg;
                
                if (difference > 5) {
                    return `Improving (+${Math.round(difference)} WPM)`;
                } else if (difference < -5) {
                    return `Declining (${Math.round(difference)} WPM)`;
                } else {
                    return `Stable (±${Math.round(Math.abs(difference))} WPM)`;
                }
            }

            updateKeyboardHeatmap() {
                // Clear all error classes
                document.querySelectorAll('.key').forEach(key => {
                    key.classList.remove('error-1', 'error-2', 'error-3', 'error-4');
                });
                
                // Apply error intensity based on error count
                Object.entries(this.errorsByKey).forEach(([char, count]) => {
                    const key = document.querySelector(`[data-key="${char.toLowerCase()}"]`);
                    if (key) {
                        if (count >= 4) {
                            key.classList.add('error-4');
                        } else if (count >= 3) {
                            key.classList.add('error-3');
                        } else if (count >= 2) {
                            key.classList.add('error-2');
                        } else if (count >= 1) {
                            key.classList.add('error-1');
                        }
                    }
                });
                
                // Handle space key specially
                if (this.errorsByKey[' ']) {
                    const spaceKey = document.querySelector('[data-key="space"]');
                    const count = this.errorsByKey[' '];
                    if (spaceKey) {
                        if (count >= 4) {
                            spaceKey.classList.add('error-4');
                        } else if (count >= 3) {
                            spaceKey.classList.add('error-3');
                        } else if (count >= 2) {
                            spaceKey.classList.add('error-2');
                        } else if (count >= 1) {
                            spaceKey.classList.add('error-1');
                        }
                    }
                }
            }

            updatePerformanceIndicator(elementId, value, thresholds, reverse = false) {
                const element = document.getElementById(elementId);
                let performance, className;

                if (reverse) {
                    // Lower is better
                    if (value < thresholds[0]) {
                        performance = 'Excellent';
                        className = 'excellent';
                    } else if (value < thresholds[1]) {
                        performance = 'Good';
                        className = 'good';
                    } else if (value < thresholds[2]) {
                        performance = 'Average';
                        className = 'average';
                    } else {
                        performance = 'Poor';
                        className = 'poor';
                    }
                } else {
                    // Higher is better
                    if (value >= thresholds[0]) {
                        performance = 'Excellent';
                        className = 'excellent';
                    } else if (value >= thresholds[1]) {
                        performance = 'Good';
                        className = 'good';
                    } else if (value >= thresholds[2]) {
                        performance = 'Average';
                        className = 'average';
                    } else {
                        performance = 'Poor';
                        className = 'poor';
                    }
                }

                element.textContent = performance;
                element.className = `performance-indicator ${className}`;
            }
        }

        // Initialize the test when the page loads
        window.addEventListener('load', () => {
            new TypingTest();
        });
    </script>
</body>
</html>