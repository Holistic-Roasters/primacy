<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APEX: Go/No-Go Inhibitory Control Test</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --color-black: #080808;
            --color-dark-grey: #1a1a1a;
            --color-mid-grey: #2e2e2e;
            --color-light-grey: #888888;
            --color-white: #f5f5f5;
            --color-accent: #00ff9d;
            --color-warning: #ff6b6b;
            --color-excellent: #00ff9d;
            --color-good: #ffcc00;
            --color-average: #ff9966;
            --color-poor: #ff6b6b;
            --color-go: #00ff9d;
            --color-nogo: #ff6b6b;
            --color-neutral: #4169e1;
            --font-primary: 'Roboto', sans-serif;
            --font-display: 'Roboto Condensed', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--color-black);
            font-family: var(--font-primary);
            color: var(--color-white);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 0;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .header h1 {
            font-family: var(--font-display);
            font-size: 3rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, var(--color-accent), var(--color-white));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.2rem;
            color: var(--color-light-grey);
            max-width: 700px;
            margin: 0 auto;
        }

        .test-container {
            background: var(--color-dark-grey);
            border-radius: 20px;
            padding: 2rem;
            position: relative;
            box-shadow: 0 0 50px rgba(0, 255, 157, 0.1);
            margin-bottom: 2rem;
        }

        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .mode-btn {
            background: var(--color-black);
            border: 2px solid var(--color-mid-grey);
            color: var(--color-light-grey);
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
            font-weight: 500;
            position: relative;
            min-width: 180px;
            text-align: center;
        }

        .mode-btn:hover {
            border-color: var(--color-accent);
            color: var(--color-accent);
        }

        .mode-btn.active {
            background: var(--color-accent);
            color: var(--color-black);
            border-color: var(--color-accent);
        }

        .mode-description {
            display: block;
            font-size: 0.7rem;
            opacity: 0.8;
            margin-top: 3px;
            font-weight: normal;
        }

        .test-config {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .config-item {
            text-align: center;
        }

        .config-label {
            color: var(--color-accent);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .config-value {
            font-family: var(--font-display);
            font-size: 1.5rem;
            color: var(--color-white);
        }

        .instructions {
            text-align: center;
            margin-bottom: 2rem;
            padding: 25px;
            background: var(--color-black);
            border-radius: 15px;
            border-left: 4px solid var(--color-accent);
        }

        .instructions h3 {
            font-family: var(--font-display);
            font-size: 1.5rem;
            color: var(--color-accent);
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .instructions p {
            color: var(--color-light-grey);
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .instruction-examples {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .example-item {
            text-align: center;
        }

        .example-stimulus {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--font-display);
            font-size: 2rem;
            font-weight: bold;
            margin: 0 auto 10px;
            border: 3px solid;
        }

        .example-go {
            background: var(--color-go);
            color: var(--color-black);
            border-color: var(--color-white);
        }

        .example-nogo {
            background: var(--color-nogo);
            color: var(--color-white);
            border-color: var(--color-white);
        }

        .example-label {
            font-size: 0.9rem;
            color: var(--color-light-grey);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stimulus-area {
            position: relative;
            width: 400px;
            height: 400px;
            margin: 0 auto 2rem;
            background: var(--color-black);
            border-radius: 15px;
            border: 2px solid var(--color-mid-grey);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stimulus {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--font-display);
            font-size: 3rem;
            font-weight: bold;
            opacity: 0;
            transform: scale(0);
            transition: all 0.2s ease;
            border: 4px solid;
            cursor: pointer;
            text-shadow: 0 0 10px currentColor;
        }

        .stimulus.active {
            opacity: 1;
            transform: scale(1);
        }

        .stimulus.go {
            background: var(--color-go);
            color: var(--color-black);
            border-color: var(--color-white);
            box-shadow: 0 0 30px rgba(0, 255, 157, 0.5);
        }

        .stimulus.nogo {
            background: var(--color-nogo);
            color: var(--color-white);
            border-color: var(--color-white);
            box-shadow: 0 0 30px rgba(255, 107, 107, 0.5);
        }

        .stimulus.neutral {
            background: var(--color-neutral);
            color: var(--color-white);
            border-color: var(--color-white);
            box-shadow: 0 0 30px rgba(65, 105, 225, 0.5);
        }

        .stimulus.correct-response {
            animation: correctPulse 0.5s ease;
        }

        .stimulus.incorrect-response {
            animation: incorrectShake 0.5s ease;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); filter: brightness(1.3); }
        }

        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0) scale(1); }
            25% { transform: translateX(-10px) scale(1); }
            75% { transform: translateX(10px) scale(1); }
        }

        .live-feedback {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 20px;
            border-radius: 15px;
            border: 2px solid var(--color-accent);
            text-align: center;
            min-width: 120px;
        }

        .feedback-label {
            color: var(--color-light-grey);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .feedback-value {
            font-family: var(--font-display);
            font-size: 1.5rem;
            color: var(--color-accent);
        }

        .progress-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 15px 20px;
            background: var(--color-black);
            border-radius: 15px;
        }

        .progress-info {
            display: flex;
            gap: 30px;
        }

        .progress-item {
            text-align: center;
        }

        .progress-label {
            color: var(--color-light-grey);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .progress-value {
            font-family: var(--font-display);
            font-size: 1.3rem;
            color: var(--color-accent);
            margin-top: 3px;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: var(--color-mid-grey);
            border-radius: 4px;
            margin: 0 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--color-accent), var(--color-white));
            border-radius: 4px;
            width: 0%;
            transition: width 0.3s ease;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .control-btn {
            background: var(--color-accent);
            color: var(--color-black);
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .control-btn:hover {
            background: var(--color-white);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 157, 0.3);
        }

        .control-btn:disabled {
            background: var(--color-mid-grey);
            color: var(--color-light-grey);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .control-btn.restart {
            background: var(--color-warning);
        }

        .message-display {
            text-align: center;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 2rem;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .message-display.waiting {
            background: rgba(255, 107, 107, 0.1);
            color: var(--color-warning);
            border: 2px solid var(--color-warning);
        }

        .message-display.active {
            background: rgba(0, 255, 157, 0.1);
            color: var(--color-accent);
            border: 2px solid var(--color-accent);
        }

        .message-display.complete {
            background: rgba(255, 255, 255, 0.1);
            color: var(--color-white);
            border: 2px solid var(--color-white);
        }

        .results-container {
            background: var(--color-dark-grey);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 0 50px rgba(0, 255, 157, 0.1);
        }

        .results-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .results-header h2 {
            font-family: var(--font-display);
            font-size: 2rem;
            color: var(--color-accent);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--color-black);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid var(--color-mid-grey);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: var(--color-accent);
            transform: translateY(-2px);
        }

        .stat-value {
            font-family: var(--font-display);
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--color-light-grey);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
        }

        .performance-indicator {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 10px;
        }

        .excellent { 
            background: var(--color-excellent); 
            color: var(--color-black); 
        }
        .good { 
            background: var(--color-good); 
            color: var(--color-black); 
        }
        .average { 
            background: var(--color-average); 
            color: var(--color-black); 
        }
        .poor { 
            background: var(--color-poor); 
            color: var(--color-white); 
        }

        .inhibition-analysis {
            background: var(--color-black);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        .analysis-header {
            color: var(--color-accent);
            font-family: var(--font-display);
            font-size: 1.3rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
        }

        .inhibition-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .inhibition-card {
            background: var(--color-mid-grey);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .inhibition-title {
            color: var(--color-accent);
            font-weight: bold;
            margin-bottom: 10px;
            text-transform: uppercase;
            font-size: 0.9rem;
        }

        .inhibition-value {
            font-family: var(--font-display);
            font-size: 2rem;
            color: var(--color-white);
            margin-bottom: 5px;
        }

        .inhibition-label {
            font-size: 0.8rem;
            color: var(--color-light-grey);
        }

        .trial-sequence {
            background: var(--color-black);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        .sequence-header {
            color: var(--color-accent);
            font-family: var(--font-display);
            font-size: 1.3rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
        }

        .sequence-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 5px;
            max-height: 200px;
            overflow-y: auto;
        }

        .trial-result {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            border: 1px solid var(--color-mid-grey);
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .trial-result:hover {
            transform: scale(1.1);
        }

        .trial-result.go-correct {
            background: var(--color-go);
            color: var(--color-black);
        }

        .trial-result.go-miss {
            background: var(--color-mid-grey);
            color: var(--color-light-grey);
            border: 2px solid var(--color-go);
        }

        .trial-result.nogo-correct {
            background: var(--color-nogo);
            color: var(--color-white);
        }

        .trial-result.nogo-false {
            background: var(--color-warning);
            color: var(--color-white);
            border: 2px solid var(--color-nogo);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .stimulus-area {
                width: 300px;
                height: 300px;
            }

            .stimulus {
                width: 100px;
                height: 100px;
                font-size: 2.5rem;
            }

            .mode-selector {
                flex-direction: column;
                align-items: center;
            }

            .mode-btn {
                width: 250px;
            }

            .test-config {
                flex-direction: column;
                gap: 15px;
            }

            .controls {
                flex-direction: column;
                align-items: center;
            }

            .control-btn {
                width: 200px;
            }

            .progress-info {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .live-feedback {
                position: static;
                margin-bottom: 1rem;
            }

            .instruction-examples {
                flex-direction: column;
                align-items: center;
                gap: 20px;
            }
        }

        .hidden {
            display: none;
        }

        .countdown {
            font-family: var(--font-display);
            font-size: 4rem;
            color: var(--color-accent);
            text-align: center;
            text-shadow: 0 0 20px var(--color-accent);
            margin: 2rem 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>APEX GO/NO-GO</h1>
            <p>Test your inhibitory control and impulse management. Respond quickly to "Go" stimuli while resisting the urge to respond to "No-Go" stimuli.</p>
        </div>

        <div class="test-container">
            <div class="mode-selector">
                <button class="mode-btn active" data-mode="classic">
                    Classic Test
                    <span class="mode-description">Green Go, Red Stop</span>
                </button>
                <button class="mode-btn" data-mode="letters">
                    Letter Test
                    <span class="mode-description">X = Go, O = No-Go</span>
                </button>
                <button class="mode-btn" data-mode="numbers">
                    Number Test
                    <span class="mode-description">Even = Go, Odd = No-Go</span>
                </button>
                <button class="mode-btn" data-mode="shapes">
                    Shape Test
                    <span class="mode-description">Circle = Go, Square = No-Go</span>
                </button>
            </div>

            <div class="test-config">
                <div class="config-item">
                    <div class="config-label">Mode</div>
                    <div class="config-value" id="testMode">Classic</div>
                </div>
                <div class="config-item">
                    <div class="config-label">Trials</div>
                    <div class="config-value" id="totalTrials">100</div>
                </div>
                <div class="config-item">
                    <div class="config-label">Go Ratio</div>
                    <div class="config-value" id="goRatio">70%</div>
                </div>
                <div class="config-item">
                    <div class="config-label">Speed</div>
                    <div class="config-value" id="stimulusSpeed">1.5s</div>
                </div>
            </div>

            <div class="instructions" id="instructions">
                <h3>Classic Go/No-Go Test</h3>
                <p>Click or press SPACEBAR when you see a <strong>GREEN</strong> circle. Do NOT respond to <strong>RED</strong> circles.</p>
                <div class="instruction-examples">
                    <div class="example-item">
                        <div class="example-stimulus example-go">GO</div>
                        <div class="example-label">Click Quickly!</div>
                    </div>
                    <div class="example-item">
                        <div class="example-stimulus example-nogo">STOP</div>
                        <div class="example-label">Don't Click!</div>
                    </div>
                </div>
                <p>React as fast as possible to Go stimuli while maintaining perfect inhibitory control for No-Go stimuli.</p>
            </div>

            <div class="progress-container">
                <div class="progress-info">
                    <div class="progress-item">
                        <div class="progress-label">Trial</div>
                        <div class="progress-value" id="currentTrial">0</div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-label">Accuracy</div>
                        <div class="progress-value" id="currentAccuracy">100%</div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-info">
                    <div class="progress-item">
                        <div class="progress-label">Go RT</div>
                        <div class="progress-value" id="avgReactionTime">-</div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-label">Inhibition</div>
                        <div class="progress-value" id="inhibitionRate">100%</div>
                    </div>
                </div>
            </div>

            <div class="stimulus-area">
                <div class="live-feedback">
                    <div class="feedback-label">Last RT</div>
                    <div class="feedback-value" id="lastRT">-</div>
                </div>
                <div class="stimulus" id="stimulus">READY</div>
            </div>

            <div class="message-display waiting" id="messageDisplay">
                Click START to begin your inhibitory control assessment
            </div>

            <div class="controls">
                <button class="control-btn" id="startBtn">Start Test</button>
                <button class="control-btn restart" id="restartBtn" disabled>Restart</button>
                <button class="control-btn" id="resetBtn">Reset</button>
            </div>
        </div>

        <div class="results-container" id="resultsContainer">
            <div class="results-header">
                <h2>Inhibitory Control Analysis</h2>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="overallAccuracy">-</div>
                    <div class="stat-label">Overall Accuracy</div>
                    <div class="performance-indicator" id="accuracyPerformance">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="goAccuracy">-</div>
                    <div class="stat-label">Go Accuracy</div>
                    <div class="performance-indicator" id="goPerformance">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="nogoAccuracy">-</div>
                    <div class="stat-label">No-Go Accuracy</div>
                    <div class="performance-indicator" id="nogoPerformance">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="inhibitionScore">-</div>
                    <div class="stat-label">Inhibition Score</div>
                    <div class="performance-indicator" id="inhibitionPerformance">-</div>
                </div>
            </div>

            <div class="inhibition-analysis">
                <div class="analysis-header">Performance Breakdown</div>
                <div class="inhibition-grid">
                    <div class="inhibition-card">
                        <div class="inhibition-title">Go Reaction Time</div>
                        <div class="inhibition-value" id="goReactionTime">-</div>
                        <div class="inhibition-label">Average milliseconds</div>
                    </div>
                    <div class="inhibition-card">
                        <div class="inhibition-title">False Alarms</div>
                        <div class="inhibition-value" id="falseAlarms">-</div>
                        <div class="inhibition-label">No-Go errors</div>
                    </div>
                    <div class="inhibition-card">
                        <div class="inhibition-title">Missed Responses</div>
                        <div class="inhibition-value" id="missedResponses">-</div>
                        <div class="inhibition-label">Go misses</div>
                    </div>
                    <div class="inhibition-card">
                        <div class="inhibition-title">Response Bias</div>
                        <div class="inhibition-value" id="responseBias">-</div>
                        <div class="inhibition-label">Impulsivity measure</div>
                    </div>
                </div>
                <p style="color: var(--color-light-grey); font-size: 0.9rem;">
                    Lower false alarms indicate better inhibitory control. Faster Go reaction times show good responsiveness.
                </p>
            </div>

            <div class="trial-sequence">
                <div class="sequence-header">Trial Sequence</div>
                <div class="sequence-grid" id="trialGrid">
                    <div style="color: var(--color-light-grey); font-style: italic; grid-column: 1 / -1; text-align: center; padding: 20px;">
                        No trials completed yet
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class GoNoGoTest {
            constructor() {
                this.mode = 'classic';
                this.isActive = false;
                this.isPaused = false;
                this.currentTrial = 0;
                this.totalTrials = 100;
                this.goRatio = 0.7; // 70% go trials
                this.stimulusDuration = 500; // ms
                this.isiDuration = 1000; // Inter-stimulus interval
                
                this.trials = [];
                this.responses = [];
                this.trialResults = [];
                this.reactionTimes = [];
                
                this.goCorrect = 0;
                this.goMissed = 0;
                this.nogoCorrect = 0;
                this.nogoFalseAlarms = 0;
                
                this.stimulusStartTime = 0;
                this.currentStimulus = null;
                
                // Stimulus definitions
                this.stimuli = {
                    classic: {
                        go: { type: 'color', value: 'GO', class: 'go' },
                        nogo: { type: 'color', value: 'STOP', class: 'nogo' }
                    },
                    letters: {
                        go: { type: 'letter', value: 'X', class: 'go' },
                        nogo: { type: 'letter', value: 'O', class: 'nogo' }
                    },
                    numbers: {
                        go: { type: 'number', value: ['2', '4', '6', '8'], class: 'go' },
                        nogo: { type: 'number', value: ['1', '3', '5', '7', '9'], class: 'nogo' }
                    },
                    shapes: {
                        go: { type: 'shape', value: '●', class: 'go' },
                        nogo: { type: 'shape', value: '■', class: 'nogo' }
                    }
                };
                
                this.initElements();
                this.setupEventListeners();
                this.updateDisplay();
                this.updateInstructions();
            }

            initElements() {
                this.stimulus = document.getElementById('stimulus');
                this.messageDisplay = document.getElementById('messageDisplay');
                this.startBtn = document.getElementById('startBtn');
                this.restartBtn = document.getElementById('restartBtn');
                this.resetBtn = document.getElementById('resetBtn');
                
                this.currentTrialDisplay = document.getElementById('currentTrial');
                this.currentAccuracyDisplay = document.getElementById('currentAccuracy');
                this.avgReactionTimeDisplay = document.getElementById('avgReactionTime');
                this.inhibitionRateDisplay = document.getElementById('inhibitionRate');
                this.progressFill = document.getElementById('progressFill');
                this.lastRTDisplay = document.getElementById('lastRT');
                
                this.instructions = document.getElementById('instructions');
                this.testModeDisplay = document.getElementById('testMode');
                this.totalTrialsDisplay = document.getElementById('totalTrials');
                this.goRatioDisplay = document.getElementById('goRatio');
                this.stimulusSpeedDisplay = document.getElementById('stimulusSpeed');
            }

            setupEventListeners() {
                // Mode selection
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        if (this.isActive) return;
                        
                        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        
                        this.mode = e.target.dataset.mode;
                        this.updateDisplay();
                        this.updateInstructions();
                    });
                });

                // Control buttons
                this.startBtn.addEventListener('click', () => this.startTest());
                this.restartBtn.addEventListener('click', () => this.restartTest());
                this.resetBtn.addEventListener('click', () => this.resetTest());

                // Response handling - both click and keyboard
                this.stimulus.addEventListener('click', () => this.recordResponse());
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space' && this.isActive) {
                        e.preventDefault();
                        this.recordResponse();
                    }
                });

                // Prevent accidental interactions
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space') e.preventDefault();
                });
            }

            updateDisplay() {
                this.testModeDisplay.textContent = this.mode.charAt(0).toUpperCase() + this.mode.slice(1);
                this.totalTrialsDisplay.textContent = this.totalTrials;
                this.goRatioDisplay.textContent = `${Math.round(this.goRatio * 100)}%`;
                this.stimulusSpeedDisplay.textContent = `${(this.stimulusDuration + this.isiDuration) / 1000}s`;
            }

            updateInstructions() {
                const instructions = {
                    classic: {
                        title: 'Classic Go/No-Go Test',
                        text: 'Click or press SPACEBAR when you see a <strong>GREEN</strong> circle. Do NOT respond to <strong>RED</strong> circles.',
                        examples: [
                            { stimulus: 'GO', class: 'example-go', label: 'Click Quickly!' },
                            { stimulus: 'STOP', class: 'example-nogo', label: 'Don\'t Click!' }
                        ]
                    },
                    letters: {
                        title: 'Letter Go/No-Go Test',
                        text: 'Click or press SPACEBAR when you see the letter <strong>X</strong>. Do NOT respond to the letter <strong>O</strong>.',
                        examples: [
                            { stimulus: 'X', class: 'example-go', label: 'Click Quickly!' },
                            { stimulus: 'O', class: 'example-nogo', label: 'Don\'t Click!' }
                        ]
                    },
                    numbers: {
                        title: 'Number Go/No-Go Test',
                        text: 'Click or press SPACEBAR when you see <strong>EVEN</strong> numbers (2,4,6,8). Do NOT respond to <strong>ODD</strong> numbers (1,3,5,7,9).',
                        examples: [
                            { stimulus: '4', class: 'example-go', label: 'Even - Click!' },
                            { stimulus: '7', class: 'example-nogo', label: 'Odd - Don\'t Click!' }
                        ]
                    },
                    shapes: {
                        title: 'Shape Go/No-Go Test',
                        text: 'Click or press SPACEBAR when you see a <strong>CIRCLE</strong> (●). Do NOT respond to <strong>SQUARES</strong> (■).',
                        examples: [
                            { stimulus: '●', class: 'example-go', label: 'Circle - Click!' },
                            { stimulus: '■', class: 'example-nogo', label: 'Square - Don\'t Click!' }
                        ]
                    }
                };

                const instruction = instructions[this.mode];
                
                const examplesHTML = instruction.examples.map(ex => `
                    <div class="example-item">
                        <div class="example-stimulus ${ex.class}">${ex.stimulus}</div>
                        <div class="example-label">${ex.label}</div>
                    </div>
                `).join('');

                this.instructions.innerHTML = `
                    <h3>${instruction.title}</h3>
                    <p>${instruction.text}</p>
                    <div class="instruction-examples">${examplesHTML}</div>
                    <p>React as fast as possible to Go stimuli while maintaining perfect inhibitory control for No-Go stimuli.</p>
                `;
            }

            async startTest() {
                if (this.isActive) return;
                
                this.isActive = true;
                this.isPaused = false;
                this.currentTrial = 0;
                this.trials = [];
                this.responses = [];
                this.trialResults = [];
                this.reactionTimes = [];
                this.goCorrect = 0;
                this.goMissed = 0;
                this.nogoCorrect = 0;
                this.nogoFalseAlarms = 0;
                
                this.startBtn.disabled = true;
                this.restartBtn.disabled = false;
                this.messageDisplay.textContent = 'Get ready...';
                this.messageDisplay.className = 'message-display waiting';

                // Generate trial sequence
                this.generateTrials();

                // Countdown
                await this.showCountdown();
                
                if (this.isActive) {
                    this.messageDisplay.textContent = 'Focus! Respond only to Go stimuli!';
                    this.messageDisplay.className = 'message-display active';
                    this.runTrial();
                }
            }

            generateTrials() {
                this.trials = [];
                const goTrials = Math.round(this.totalTrials * this.goRatio);
                const nogoTrials = this.totalTrials - goTrials;
                
                // Generate go trials
                for (let i = 0; i < goTrials; i++) {
                    this.trials.push({
                        type: 'go',
                        stimulus: this.getRandomStimulus('go'),
                        expectedResponse: true
                    });
                }
                
                // Generate no-go trials
                for (let i = 0; i < nogoTrials; i++) {
                    this.trials.push({
                        type: 'nogo',
                        stimulus: this.getRandomStimulus('nogo'),
                        expectedResponse: false
                    });
                }
                
                // Shuffle trials
                this.shuffleArray(this.trials);
            }

            getRandomStimulus(type) {
                const stimulusSet = this.stimuli[this.mode][type];
                
                if (Array.isArray(stimulusSet.value)) {
                    // Random selection from array (e.g., numbers)
                    const randomValue = stimulusSet.value[Math.floor(Math.random() * stimulusSet.value.length)];
                    return {
                        ...stimulusSet,
                        value: randomValue
                    };
                } else {
                    // Single value
                    return stimulusSet;
                }
            }

            shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            async showCountdown() {
                const countdown = document.createElement('div');
                countdown.className = 'countdown';
                this.messageDisplay.appendChild(countdown);
                
                for (let i = 3; i > 0; i--) {
                    countdown.textContent = i;
                    await this.delay(1000);
                    if (!this.isActive) return;
                }
                
                countdown.remove();
            }

            async runTrial() {
                if (!this.isActive || this.isPaused) return;
                
                if (this.currentTrial >= this.totalTrials) {
                    this.endTest();
                    return;
                }

                const trial = this.trials[this.currentTrial];
                this.currentStimulus = trial;
                this.currentTrial++;
                this.updateProgress();
                
                // Clear previous response
                this.hasResponded = false;
                
                // Show stimulus
                this.stimulusStartTime = performance.now();
                await this.showStimulus(trial);
                
                // ISI (Inter-Stimulus Interval)
                await this.delay(this.isiDuration);
                
                // Check for response timeout
                this.checkResponse();
                
                // Continue to next trial
                if (this.isActive) {
                    this.runTrial();
                }
            }

            async showStimulus(trial) {
                // Set stimulus appearance
                this.stimulus.textContent = trial.stimulus.value;
                this.stimulus.className = `stimulus ${trial.stimulus.class} active`;
                
                await this.delay(this.stimulusDuration);
                
                // Clear stimulus
                this.stimulus.classList.remove('active');
                this.stimulus.textContent = '';
            }

            recordResponse() {
                if (!this.isActive || !this.currentStimulus || this.hasResponded) return;
                
                this.hasResponded = true;
                const reactionTime = performance.now() - this.stimulusStartTime;
                
                this.responses.push({
                    trial: this.currentTrial,
                    reactionTime: reactionTime,
                    stimulus: this.currentStimulus,
                    responded: true
                });

                // Update live feedback
                this.lastRTDisplay.textContent = `${Math.round(reactionTime)}ms`;
                
                // Visual feedback
                if (this.currentStimulus.expectedResponse) {
                    // Correct go response
                    this.goCorrect++;
                    this.reactionTimes.push(reactionTime);
                    this.stimulus.classList.add('correct-response');
                } else {
                    // False alarm (responded to no-go)
                    this.nogoFalseAlarms++;
                    this.stimulus.classList.add('incorrect-response');
                }
                
                // Record result
                this.trialResults.push({
                    type: this.currentStimulus.type,
                    responded: true,
                    correct: this.currentStimulus.expectedResponse,
                    reactionTime: reactionTime,
                    stimulus: this.currentStimulus.stimulus.value
                });

                this.updateTrialHistory();
                
                // Clear visual feedback
                setTimeout(() => {
                    this.stimulus.classList.remove('correct-response', 'incorrect-response');
                }, 300);
            }

            checkResponse() {
                // If no response was recorded for this trial
                if (!this.hasResponded && this.currentStimulus) {
                    this.responses.push({
                        trial: this.currentTrial,
                        reactionTime: null,
                        stimulus: this.currentStimulus,
                        responded: false
                    });

                    if (this.currentStimulus.expectedResponse) {
                        // Missed go trial
                        this.goMissed++;
                    } else {
                        // Correct no-go (didn't respond)
                        this.nogoCorrect++;
                    }

                    this.trialResults.push({
                        type: this.currentStimulus.type,
                        responded: false,
                        correct: !this.currentStimulus.expectedResponse,
                        reactionTime: null,
                        stimulus: this.currentStimulus.stimulus.value
                    });

                    this.updateTrialHistory();
                }
            }

            updateProgress() {
                this.currentTrialDisplay.textContent = this.currentTrial;
                
                const totalCorrect = this.goCorrect + this.nogoCorrect;
                const accuracy = this.responses.length > 0 ? 
                    Math.round((totalCorrect / this.responses.length) * 100) : 100;
                this.currentAccuracyDisplay.textContent = `${accuracy}%`;
                
                const avgRT = this.reactionTimes.length > 0 ? 
                    Math.round(this.reactionTimes.reduce((a, b) => a + b, 0) / this.reactionTimes.length) : 0;
                this.avgReactionTimeDisplay.textContent = avgRT > 0 ? `${avgRT}ms` : '-';
                
                const inhibitionRate = this.responses.length > 0 ? 
                    Math.round((this.nogoCorrect / Math.max(1, this.nogoCorrect + this.nogoFalseAlarms)) * 100) : 100;
                this.inhibitionRateDisplay.textContent = `${inhibitionRate}%`;
                
                const progress = (this.currentTrial / this.totalTrials) * 100;
                this.progressFill.style.width = `${progress}%`;
            }

            updateTrialHistory() {
                const trialGrid = document.getElementById('trialGrid');
                
                // Clear if this is the first result
                if (this.trialResults.length === 1) {
                    trialGrid.innerHTML = '';
                }

                const result = this.trialResults[this.trialResults.length - 1];
                const trial = document.createElement('div');
                trial.className = 'trial-result';
                trial.textContent = result.stimulus;
                
                if (result.type === 'go') {
                    if (result.responded && result.correct) {
                        trial.classList.add('go-correct');
                        trial.title = `Go trial: Correct response (${Math.round(result.reactionTime)}ms)`;
                    } else {
                        trial.classList.add('go-miss');
                        trial.title = 'Go trial: Missed response';
                    }
                } else {
                    if (!result.responded && result.correct) {
                        trial.classList.add('nogo-correct');
                        trial.title = 'No-Go trial: Correct inhibition';
                    } else {
                        trial.classList.add('nogo-false');
                        trial.title = `No-Go trial: False alarm (${Math.round(result.reactionTime)}ms)`;
                    }
                }
                
                trialGrid.appendChild(trial);
            }

            restartTest() {
                this.endTest();
                this.resetTest();
                setTimeout(() => this.startTest(), 100);
            }

            resetTest() {
                this.endTest();
                
                this.currentTrial = 0;
                this.trials = [];
                this.responses = [];
                this.trialResults = [];
                this.reactionTimes = [];
                this.goCorrect = 0;
                this.goMissed = 0;
                this.nogoCorrect = 0;
                this.nogoFalseAlarms = 0;
                this.currentStimulus = null;
                this.hasResponded = false;
                
                this.startBtn.disabled = false;
                this.restartBtn.disabled = true;
                
                this.messageDisplay.textContent = 'Click START to begin your inhibitory control assessment';
                this.messageDisplay.className = 'message-display waiting';
                
                this.stimulus.textContent = 'READY';
                this.stimulus.className = 'stimulus neutral';
                this.lastRTDisplay.textContent = '-';
                
                this.updateProgress();
                this.updateResults();
            }

            endTest() {
                this.isActive = false;
                this.isPaused = false;
                
                this.startBtn.disabled = false;
                this.restartBtn.disabled = true;
                
                this.messageDisplay.textContent = 'Test Complete! Check your inhibitory control analysis below.';
                this.messageDisplay.className = 'message-display complete';
                
                this.stimulus.textContent = 'COMPLETE';
                this.stimulus.className = 'stimulus neutral';
                
                this.updateResults();
            }

            updateResults() {
                if (this.trialResults.length === 0) {
                    // Reset display
                    document.getElementById('overallAccuracy').textContent = '-';
                    document.getElementById('goAccuracy').textContent = '-';
                    document.getElementById('nogoAccuracy').textContent = '-';
                    document.getElementById('inhibitionScore').textContent = '-';
                    return;
                }

                const totalCorrect = this.goCorrect + this.nogoCorrect;
                const overallAccuracy = Math.round((totalCorrect / this.trialResults.length) * 100);
                
                const goTrials = this.goCorrect + this.goMissed;
                const goAccuracy = goTrials > 0 ? Math.round((this.goCorrect / goTrials) * 100) : 0;
                
                const nogoTrials = this.nogoCorrect + this.nogoFalseAlarms;
                const nogoAccuracy = nogoTrials > 0 ? Math.round((this.nogoCorrect / nogoTrials) * 100) : 0;
                
                const inhibitionScore = this.calculateInhibitionScore();

                document.getElementById('overallAccuracy').textContent = `${overallAccuracy}%`;
                document.getElementById('goAccuracy').textContent = `${goAccuracy}%`;
                document.getElementById('nogoAccuracy').textContent = `${nogoAccuracy}%`;
                document.getElementById('inhibitionScore').textContent = inhibitionScore;

                // Update detailed analysis
                const avgGoRT = this.reactionTimes.length > 0 ? 
                    Math.round(this.reactionTimes.reduce((a, b) => a + b, 0) / this.reactionTimes.length) : 0;
                
                document.getElementById('goReactionTime').textContent = avgGoRT > 0 ? `${avgGoRT}ms` : '-';
                document.getElementById('falseAlarms').textContent = this.nogoFalseAlarms;
                document.getElementById('missedResponses').textContent = this.goMissed;
                document.getElementById('responseBias').textContent = this.calculateResponseBias();

                // Performance indicators
                this.updatePerformanceIndicator('accuracyPerformance', overallAccuracy, [95, 90, 85]);
                this.updatePerformanceIndicator('goPerformance', goAccuracy, [95, 90, 85]);
                this.updatePerformanceIndicator('nogoPerformance', nogoAccuracy, [95, 90, 85]);
                this.updatePerformanceIndicator('inhibitionPerformance', parseInt(inhibitionScore), [90, 80, 70]);
            }

            calculateInhibitionScore() {
                const goTrials = this.goCorrect + this.goMissed;
                const nogoTrials = this.nogoCorrect + this.nogoFalseAlarms;
                
                if (goTrials === 0 || nogoTrials === 0) return '-';
                
                const goAccuracy = this.goCorrect / goTrials;
                const nogoAccuracy = this.nogoCorrect / nogoTrials;
                const avgRT = this.reactionTimes.length > 0 ? 
                    this.reactionTimes.reduce((a, b) => a + b, 0) / this.reactionTimes.length : 1000;
                
                // Combined score: accuracy weighted by speed, with emphasis on inhibition
                const speedBonus = Math.max(0, (800 - avgRT) / 800);
                const score = (goAccuracy * 0.3 + nogoAccuracy * 0.7) * 100 * (1 + speedBonus * 0.2);
                
                return Math.round(score);
            }

            calculateResponseBias() {
                const totalResponses = this.goCorrect + this.nogoFalseAlarms;
                const totalTrials = this.trialResults.length;
                
                if (totalTrials === 0) return '-';
                
                const responseRate = totalResponses / totalTrials;
                const expectedRate = this.goRatio; // Expected response rate based on go ratio
                
                const bias = responseRate - expectedRate;
                
                if (bias > 0.1) return 'Impulsive';
                if (bias < -0.1) return 'Conservative';
                return 'Balanced';
            }

            updatePerformanceIndicator(elementId, value, thresholds, reverse = false) {
                const element = document.getElementById(elementId);
                let performance, className;

                if (reverse) {
                    // Lower is better
                    if (value < thresholds[0]) {
                        performance = 'Excellent';
                        className = 'excellent';
                    } else if (value < thresholds[1]) {
                        performance = 'Good';
                        className = 'good';
                    } else if (value < thresholds[2]) {
                        performance = 'Average';
                        className = 'average';
                    } else {
                        performance = 'Poor';
                        className = 'poor';
                    }
                } else {
                    // Higher is better
                    if (value >= thresholds[0]) {
                        performance = 'Excellent';
                        className = 'excellent';
                    } else if (value >= thresholds[1]) {
                        performance = 'Good';
                        className = 'good';
                    } else if (value >= thresholds[2]) {
                        performance = 'Average';
                        className = 'average';
                    } else {
                        performance = 'Poor';
                        className = 'poor';
                    }
                }

                element.textContent = performance;
                element.className = `performance-indicator ${className}`;
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // Initialize the test when the page loads
        window.addEventListener('load', () => {
            new GoNoGoTest();
        });
    </script>
</body>
</html>
