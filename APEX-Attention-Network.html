<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APEX: Attention Network Test</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --color-black: #080808;
            --color-dark-grey: #1a1a1a;
            --color-mid-grey: #2e2e2e;
            --color-light-grey: #888888;
            --color-white: #f5f5f5;
            --color-accent: #00ff9d;
            --color-warning: #ff6b6b;
            --color-excellent: #00ff9d;
            --color-good: #ffcc00;
            --color-average: #ff9966;
            --color-poor: #ff6b6b;
            --color-correct: #00ff9d;
            --color-incorrect: #ff6b6b;
            --color-neutral: #4169e1;
            --color-alerting: #ffcc00;
            --color-orienting: #00ff9d;
            --color-executive: #ff6b6b;
            --font-primary: 'Roboto', sans-serif;
            --font-display: 'Roboto Condensed', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--color-black);
            font-family: var(--font-primary);
            color: var(--color-white);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
            scroll-behavior: smooth;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 0;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .header h1 {
            font-family: var(--font-display);
            font-size: 3rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, var(--color-accent), var(--color-white));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.2rem;
            color: var(--color-light-grey);
            max-width: 700px;
            margin: 0 auto;
        }

        .test-container {
            background: var(--color-dark-grey);
            border-radius: 20px;
            padding: 2rem;
            position: relative;
            box-shadow: 0 0 50px rgba(0, 255, 157, 0.1);
            margin-bottom: 2rem;
        }

        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .mode-btn {
            background: var(--color-black);
            border: 2px solid var(--color-mid-grey);
            color: var(--color-light-grey);
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
            font-weight: 500;
            position: relative;
            min-width: 160px;
            text-align: center;
        }

        .mode-btn:hover {
            border-color: var(--color-accent);
            color: var(--color-accent);
        }

        .mode-btn.active {
            background: var(--color-accent);
            color: var(--color-black);
            border-color: var(--color-accent);
        }

        .mode-description {
            display: block;
            font-size: 0.7rem;
            opacity: 0.8;
            margin-top: 3px;
            font-weight: normal;
        }

        .test-config {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .config-item {
            text-align: center;
        }

        .config-label {
            color: var(--color-accent);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .config-value {
            font-family: var(--font-display);
            font-size: 1.5rem;
            color: var(--color-white);
        }

        .instructions {
            text-align: center;
            margin-bottom: 2rem;
            padding: 25px;
            background: var(--color-black);
            border-radius: 15px;
            border-left: 4px solid var(--color-accent);
        }

        .instructions h3 {
            font-family: var(--font-display);
            font-size: 1.5rem;
            color: var(--color-accent);
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .instructions p {
            color: var(--color-light-grey);
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .cue-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 1.5rem;
        }

        .cue-card {
            background: var(--color-mid-grey);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid var(--color-accent);
            text-align: center;
        }

        .cue-title {
            font-family: var(--font-display);
            font-size: 1.2rem;
            color: var(--color-accent);
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .cue-description {
            color: var(--color-white);
            font-size: 0.9rem;
        }

        .cue-example {
            margin-top: 10px;
            font-family: monospace;
            font-size: 1.2rem;
            color: var(--color-accent);
        }

        .progress-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 15px 20px;
            background: var(--color-black);
            border-radius: 15px;
        }

        .progress-info {
            display: flex;
            gap: 30px;
        }

        .progress-item {
            text-align: center;
        }

        .progress-label {
            color: var(--color-light-grey);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .progress-value {
            font-family: var(--font-display);
            font-size: 1.3rem;
            color: var(--color-accent);
            margin-top: 3px;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: var(--color-mid-grey);
            border-radius: 4px;
            margin: 0 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--color-accent), var(--color-white));
            border-radius: 4px;
            width: 0%;
            transition: width 0.3s ease;
        }

        .stimulus-container {
            position: relative;
            width: 600px;
            height: 400px;
            margin: 0 auto 2rem;
            background: var(--color-black);
            border-radius: 15px;
            border: 2px solid var(--color-mid-grey);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fixation-cross {
            position: absolute;
            font-size: 2rem;
            color: var(--color-white);
            font-weight: bold;
            user-select: none;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .cue-display {
            position: absolute;
            font-size: 2rem;
            color: var(--color-accent);
            font-weight: bold;
            user-select: none;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .arrow-row {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
        }

        .arrow {
            font-size: 3rem;
            font-weight: bold;
            user-select: none;
            transition: all 0.3s ease;
        }

        .arrow.target {
            color: var(--color-white);
        }

        .arrow.flanker {
            color: var(--color-light-grey);
        }

        .cue-asterisk {
            position: absolute;
            font-size: 2rem;
            color: var(--color-accent);
            font-weight: bold;
        }

        .cue-asterisk.above { top: 20%; }
        .cue-asterisk.below { bottom: 20%; }
        .cue-asterisk.center { top: 50%; transform: translateY(-50%); }

        .response-buttons {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .response-btn {
            background: var(--color-mid-grey);
            color: var(--color-white);
            border: 3px solid var(--color-light-grey);
            padding: 20px 40px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.2s ease;
            font-size: 1.2rem;
            min-width: 150px;
        }

        .response-btn:hover:not(:disabled) {
            background: var(--color-light-grey);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 255, 255, 0.2);
        }

        .response-btn:active:not(:disabled) {
            transform: translateY(0);
        }

        .response-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .response-btn.correct-flash {
            background: var(--color-correct);
            border-color: var(--color-correct);
            color: var(--color-black);
        }

        .response-btn.incorrect-flash {
            background: var(--color-incorrect);
            border-color: var(--color-incorrect);
            color: var(--color-white);
        }

        .feedback-display {
            text-align: center;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .feedback-text {
            font-size: 1.5rem;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .feedback-text.show {
            opacity: 1;
        }

        .feedback-text.correct {
            color: var(--color-correct);
        }

        .feedback-text.incorrect {
            color: var(--color-incorrect);
        }

        .reaction-time {
            font-family: var(--font-display);
            font-size: 1.2rem;
            color: var(--color-light-grey);
            margin-left: 15px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .control-btn {
            background: var(--color-accent);
            color: var(--color-black);
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .control-btn:hover {
            background: var(--color-white);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 157, 0.3);
        }

        .control-btn:disabled {
            background: var(--color-mid-grey);
            color: var(--color-light-grey);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .control-btn.restart {
            background: var(--color-warning);
        }

        .message-display {
            text-align: center;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 2rem;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .message-display.waiting {
            background: rgba(255, 107, 107, 0.1);
            color: var(--color-warning);
            border: 2px solid var(--color-warning);
        }

        .message-display.active {
            background: rgba(0, 255, 157, 0.1);
            color: var(--color-accent);
            border: 2px solid var(--color-accent);
        }

        .message-display.complete {
            background: rgba(255, 255, 255, 0.1);
            color: var(--color-white);
            border: 2px solid var(--color-white);
        }

        .results-container {
            background: var(--color-dark-grey);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 0 50px rgba(0, 255, 157, 0.1);
        }

        .results-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .results-header h2 {
            font-family: var(--font-display);
            font-size: 2rem;
            color: var(--color-accent);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--color-black);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid var(--color-mid-grey);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: var(--color-accent);
            transform: translateY(-2px);
        }

        .stat-value {
            font-family: var(--font-display);
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--color-light-grey);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
        }

        .performance-indicator {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 10px;
        }

        .excellent { 
            background: var(--color-excellent); 
            color: var(--color-black); 
        }
        .good { 
            background: var(--color-good); 
            color: var(--color-black); 
        }
        .average { 
            background: var(--color-average); 
            color: var(--color-black); 
        }
        .poor { 
            background: var(--color-poor); 
            color: var(--color-white); 
        }

        .network-analysis {
            background: var(--color-black);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        .analysis-header {
            color: var(--color-accent);
            font-family: var(--font-display);
            font-size: 1.3rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
        }

        .network-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .network-item {
            background: var(--color-mid-grey);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .network-item.alerting {
            border-color: var(--color-alerting);
        }

        .network-item.orienting {
            border-color: var(--color-orienting);
        }

        .network-item.executive {
            border-color: var(--color-executive);
        }

        .network-label {
            font-size: 0.9rem;
            color: var(--color-light-grey);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .network-value {
            font-family: var(--font-display);
            font-size: 1.8rem;
            color: var(--color-white);
            margin-bottom: 5px;
        }

        .network-sublabel {
            font-size: 0.8rem;
            color: var(--color-light-grey);
        }

        .condition-breakdown {
            background: var(--color-black);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        .breakdown-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .breakdown-table th,
        .breakdown-table td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid var(--color-mid-grey);
        }

        .breakdown-table th {
            background: var(--color-mid-grey);
            color: var(--color-accent);
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
        }

        .breakdown-table td {
            color: var(--color-white);
            font-family: var(--font-display);
            font-size: 1.1rem;
        }

        .breakdown-table tr:hover td {
            background: rgba(0, 255, 157, 0.1);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .stimulus-container {
                width: 90%;
                max-width: 400px;
                height: 300px;
            }

            .arrow {
                font-size: 2rem;
            }

            .response-buttons {
                flex-direction: column;
                align-items: center;
            }

            .response-btn {
                width: 200px;
            }

            .mode-selector {
                flex-direction: column;
                align-items: center;
            }

            .mode-btn {
                width: 250px;
            }

            .test-config {
                flex-direction: column;
                gap: 15px;
            }

            .controls {
                flex-direction: column;
                align-items: center;
            }

            .control-btn {
                width: 200px;
            }

            .progress-info {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .cue-types {
                grid-template-columns: 1fr;
            }
        }

        .hidden {
            display: none;
        }

        .countdown {
            font-family: var(--font-display);
            font-size: 4rem;
            color: var(--color-accent);
            text-align: center;
            text-shadow: 0 0 20px var(--color-accent);
            margin: 2rem 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>APEX ATTENTION NETWORK</h1>
            <p>Measure the efficiency of your three attentional networks: alerting, orienting, and executive control. Based on the classic ANT paradigm.</p>
        </div>

        <div class="test-container">
            <div class="mode-selector">
                <button class="mode-btn active" data-mode="standard">
                    Standard ANT
                    <span class="mode-description">Full protocol</span>
                </button>
                <button class="mode-btn" data-mode="quick">
                    Quick Test
                    <span class="mode-description">5-minute version</span>
                </button>
                <button class="mode-btn" data-mode="child">
                    Child ANT
                    <span class="mode-description">Fish version</span>
                </button>
                <button class="mode-btn" data-mode="practice">
                    Practice
                    <span class="mode-description">Learn the task</span>
                </button>
            </div>

            <div class="test-config">
                <div class="config-item">
                    <div class="config-label">Mode</div>
                    <div class="config-value" id="testMode">Standard</div>
                </div>
                <div class="config-item">
                    <div class="config-label">Blocks</div>
                    <div class="config-value" id="totalBlocks">4</div>
                </div>
                <div class="config-item">
                    <div class="config-label">Trials</div>
                    <div class="config-value" id="totalTrials">96</div>
                </div>
                <div class="config-item">
                    <div class="config-label">Duration</div>
                    <div class="config-value" id="duration">~10 min</div>
                </div>
            </div>

            <div class="instructions" id="instructions">
                <h3>Attention Network Test</h3>
                <p>Focus on the central arrow and indicate its direction (LEFT or RIGHT) as quickly as possible. Ignore the flanking arrows.</p>
                
                <div class="cue-types">
                    <div class="cue-card">
                        <div class="cue-title">No Cue</div>
                        <div class="cue-description">Only fixation cross appears</div>
                        <div class="cue-example">+</div>
                    </div>
                    <div class="cue-card">
                        <div class="cue-title">Center Cue</div>
                        <div class="cue-description">Asterisk at center alerts you</div>
                        <div class="cue-example">*</div>
                    </div>
                    <div class="cue-card">
                        <div class="cue-title">Double Cue</div>
                        <div class="cue-description">Two asterisks alert you</div>
                        <div class="cue-example">* *</div>
                    </div>
                    <div class="cue-card">
                        <div class="cue-title">Spatial Cue</div>
                        <div class="cue-description">Asterisk shows target location</div>
                        <div class="cue-example">*</div>
                    </div>
                </div>
                
                <p style="margin-top: 1.5rem;">Different cue types help measure your alerting and orienting attention. The flanking arrows test your executive control.</p>
            </div>

            <div class="progress-container">
                <div class="progress-info">
                    <div class="progress-item">
                        <div class="progress-label">Block</div>
                        <div class="progress-value" id="currentBlock">0/4</div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-label">Trial</div>
                        <div class="progress-value" id="currentTrial">0</div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-info">
                    <div class="progress-item">
                        <div class="progress-label">Correct</div>
                        <div class="progress-value" id="correctCount">0</div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-label">Avg RT</div>
                        <div class="progress-value" id="avgRT">-</div>
                    </div>
                </div>
            </div>

            <div class="stimulus-container" id="stimulusContainer">
                <div class="fixation-cross" id="fixation">+</div>
                <div class="cue-display hidden" id="cueDisplay"></div>
                <div class="arrow-row hidden" id="arrowDisplay">
                    <span class="arrow flanker" id="flanker1">→</span>
                    <span class="arrow flanker" id="flanker2">→</span>
                    <span class="arrow target" id="targetArrow">→</span>
                    <span class="arrow flanker" id="flanker3">→</span>
                    <span class="arrow flanker" id="flanker4">→</span>
                </div>
            </div>

            <div class="feedback-display">
                <div class="feedback-text" id="feedbackText"></div>
            </div>

            <div class="response-buttons" id="responseButtons">
                <button class="response-btn" id="leftBtn" disabled>
                    ← LEFT<br>
                    <span style="font-size: 0.9rem; font-weight: normal;">Press A</span>
                </button>
                <button class="response-btn" id="rightBtn" disabled>
                    RIGHT →<br>
                    <span style="font-size: 0.9rem; font-weight: normal;">Press L</span>
                </button>
            </div>

            <div class="message-display waiting" id="messageDisplay">
                Click START to begin measuring your attention networks
            </div>

            <div class="controls">
                <button class="control-btn" id="startBtn">Start Test</button>
                <button class="control-btn restart" id="restartBtn" disabled>Restart</button>
                <button class="control-btn" id="resetBtn">Reset</button>
            </div>
        </div>

        <div class="results-container" id="resultsContainer">
            <div class="results-header">
                <h2>Attention Network Analysis</h2>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="overallAccuracy">-</div>
                    <div class="stat-label">Overall Accuracy</div>
                    <div class="performance-indicator" id="accuracyPerformance">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="meanRT">-</div>
                    <div class="stat-label">Mean RT (ms)</div>
                    <div class="performance-indicator" id="rtPerformance">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalErrors">-</div>
                    <div class="stat-label">Total Errors</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="trialsCompleted">0</div>
                    <div class="stat-label">Trials Completed</div>
                </div>
            </div>

            <div class="network-analysis">
                <div class="analysis-header">Network Efficiency Scores</div>
                <div class="network-grid">
                    <div class="network-item alerting">
                        <div class="network-label">Alerting Network</div>
                        <div class="network-value" id="alertingScore">-</div>
                        <div class="network-sublabel">No cue - Double cue</div>
                        <div class="performance-indicator" id="alertingPerformance">-</div>
                    </div>
                    <div class="network-item orienting">
                        <div class="network-label">Orienting Network</div>
                        <div class="network-value" id="orientingScore">-</div>
                        <div class="network-sublabel">Center cue - Spatial cue</div>
                        <div class="performance-indicator" id="orientingPerformance">-</div>
                    </div>
                    <div class="network-item executive">
                        <div class="network-label">Executive Network</div>
                        <div class="network-value" id="executiveScore">-</div>
                        <div class="network-sublabel">Incongruent - Congruent</div>
                        <div class="performance-indicator" id="executivePerformance">-</div>
                    </div>
                </div>
                <p style="color: var(--color-light-grey); font-size: 0.9rem; margin-top: 15px; text-align: center;">
                    Higher scores indicate greater network effects. Alerting and orienting show benefits from cues, while executive shows conflict cost.
                </p>
            </div>

            <div class="condition-breakdown">
                <div class="analysis-header">Performance by Condition</div>
                <table class="breakdown-table">
                    <thead>
                        <tr>
                            <th>Cue Type</th>
                            <th>Congruent RT</th>
                            <th>Incongruent RT</th>
                            <th>Accuracy</th>
                        </tr>
                    </thead>
                    <tbody id="conditionBreakdown">
                        <tr>
                            <td>No Cue</td>
                            <td id="noCueCongRT">-</td>
                            <td id="noCueIncongRT">-</td>
                            <td id="noCueAcc">-</td>
                        </tr>
                        <tr>
                            <td>Center Cue</td>
                            <td id="centerCueCongRT">-</td>
                            <td id="centerCueIncongRT">-</td>
                            <td id="centerCueAcc">-</td>
                        </tr>
                        <tr>
                            <td>Double Cue</td>
                            <td id="doubleCueCongRT">-</td>
                            <td id="doubleCueIncongRT">-</td>
                            <td id="doubleCueAcc">-</td>
                        </tr>
                        <tr>
                            <td>Spatial Cue</td>
                            <td id="spatialCueCongRT">-</td>
                            <td id="spatialCueIncongRT">-</td>
                            <td id="spatialCueAcc">-</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        class AttentionNetworkTest {
            constructor() {
                this.mode = 'standard';
                this.isActive = false;
                this.currentBlock = 0;
                this.currentTrial = 0;
                this.totalBlocks = 4;
                this.trialsPerBlock = 24;
                
                // Stimulus types
                this.cueTypes = ['none', 'center', 'double', 'spatial'];
                this.flankerTypes = ['congruent', 'incongruent'];
                this.targetLocations = ['above', 'below'];
                this.targetDirections = ['left', 'right'];
                
                // Timing parameters (in ms)
                this.fixationDuration = {
                    min: 400,
                    max: 1600
                };
                this.cueDuration = 100;
                this.cueTargetInterval = 400;
                this.targetDuration = 1700;
                this.feedbackDuration = 1000;
                this.interTrialInterval = 3500;
                
                // Data collection
                this.trialData = [];
                this.blockData = [];
                this.startTime = null;
                this.trialStartTime = null;
                
                // UI state
                this.awaitingResponse = false;
                this.currentCondition = null;
                
                this.initElements();
                this.setupEventListeners();
                this.updateDisplay();
            }

            initElements() {
                this.stimulusContainer = document.getElementById('stimulusContainer');
                this.fixation = document.getElementById('fixation');
                this.cueDisplay = document.getElementById('cueDisplay');
                this.arrowDisplay = document.getElementById('arrowDisplay');
                this.messageDisplay = document.getElementById('messageDisplay');
                this.feedbackText = document.getElementById('feedbackText');
                
                this.targetArrow = document.getElementById('targetArrow');
                this.flanker1 = document.getElementById('flanker1');
                this.flanker2 = document.getElementById('flanker2');
                this.flanker3 = document.getElementById('flanker3');
                this.flanker4 = document.getElementById('flanker4');
                
                this.leftBtn = document.getElementById('leftBtn');
                this.rightBtn = document.getElementById('rightBtn');
                this.startBtn = document.getElementById('startBtn');
                this.restartBtn = document.getElementById('restartBtn');
                this.resetBtn = document.getElementById('resetBtn');
                
                this.currentBlockDisplay = document.getElementById('currentBlock');
                this.currentTrialDisplay = document.getElementById('currentTrial');
                this.correctCountDisplay = document.getElementById('correctCount');
                this.avgRTDisplay = document.getElementById('avgRT');
                this.progressFill = document.getElementById('progressFill');
                
                this.testModeDisplay = document.getElementById('testMode');
                this.totalBlocksDisplay = document.getElementById('totalBlocks');
                this.totalTrialsDisplay = document.getElementById('totalTrials');
                this.durationDisplay = document.getElementById('duration');
            }

            setupEventListeners() {
                // Mode selection
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        if (this.isActive) return;
                        
                        const button = e.target.closest('.mode-btn');
                        if (!button) return;
                        
                        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                        button.classList.add('active');
                        
                        this.mode = button.dataset.mode;
                        this.setupModeParameters();
                        this.updateDisplay();
                    });
                });

                // Response buttons
                this.leftBtn.addEventListener('click', () => this.handleResponse('left'));
                this.rightBtn.addEventListener('click', () => this.handleResponse('right'));
                
                // Keyboard responses
                document.addEventListener('keydown', (e) => {
                    if (!this.awaitingResponse) return;
                    
                    if (e.key.toLowerCase() === 'a') {
                        this.handleResponse('left');
                    } else if (e.key.toLowerCase() === 'l') {
                        this.handleResponse('right');
                    }
                });

                // Control buttons
                this.startBtn.addEventListener('click', () => this.startTest());
                this.restartBtn.addEventListener('click', () => this.restartTest());
                this.resetBtn.addEventListener('click', () => this.resetTest());
            }

            setupModeParameters() {
                switch (this.mode) {
                    case 'standard':
                        this.totalBlocks = 4;
                        this.trialsPerBlock = 24;
                        this.targetDuration = 1700;
                        break;
                    case 'quick':
                        this.totalBlocks = 2;
                        this.trialsPerBlock = 16;
                        this.targetDuration = 1700;
                        break;
                    case 'child':
                        this.totalBlocks = 3;
                        this.trialsPerBlock = 24;
                        this.targetDuration = 2000;
                        this.feedbackDuration = 1500;
                        // In child mode, we'd use fish instead of arrows
                        break;
                    case 'practice':
                        this.totalBlocks = 1;
                        this.trialsPerBlock = 12;
                        this.targetDuration = 2000;
                        this.feedbackDuration = 1500;
                        break;
                }
            }

            updateDisplay() {
                this.testModeDisplay.textContent = this.mode.charAt(0).toUpperCase() + this.mode.slice(1);
                this.totalBlocksDisplay.textContent = this.totalBlocks;
                this.totalTrialsDisplay.textContent = this.totalBlocks * this.trialsPerBlock;
                
                const totalTime = (this.totalBlocks * this.trialsPerBlock * this.interTrialInterval) / 60000;
                this.durationDisplay.textContent = `~${Math.ceil(totalTime)} min`;
            }

            async startTest() {
                if (this.isActive) return;
                
                this.isActive = true;
                this.currentBlock = 0;
                this.currentTrial = 0;
                this.trialData = [];
                this.blockData = [];
                this.startTime = Date.now();
                
                this.setupModeParameters();
                
                this.startBtn.disabled = true;
                this.restartBtn.disabled = false;
                this.messageDisplay.textContent = 'Get ready...';
                this.messageDisplay.className = 'message-display active';
                
                // Hide instructions
                document.getElementById('instructions').style.display = 'none';
                
                // Scroll to center the stimulus container
                setTimeout(() => {
                    this.stimulusContainer.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'center'
                    });
                }, 100);

                // Countdown
                await this.showCountdown();
                
                if (this.isActive) {
                    this.runBlock();
                }
            }

            async showCountdown() {
                const countdown = document.createElement('div');
                countdown.className = 'countdown';
                this.stimulusContainer.appendChild(countdown);
                
                for (let i = 3; i > 0; i--) {
                    countdown.textContent = i;
                    await this.delay(1000);
                    if (!this.isActive) return;
                }
                
                countdown.remove();
            }

            async runBlock() {
                if (!this.isActive || this.currentBlock >= this.totalBlocks) {
                    this.endTest();
                    return;
                }
                
                this.currentBlock++;
                this.currentTrial = 0;
                
                // Generate trials for this block
                this.generateBlockTrials();
                
                // Show block message
                this.messageDisplay.textContent = `Block ${this.currentBlock} of ${this.totalBlocks}`;
                this.messageDisplay.style.display = 'block';
                await this.delay(2000);
                this.messageDisplay.style.display = 'none';
                
                if (this.isActive) {
                    this.runTrial();
                }
            }

            generateBlockTrials() {
                this.blockTrials = [];
                
                // Create all combinations of conditions
                for (let cue of this.cueTypes) {
                    for (let flanker of this.flankerTypes) {
                        for (let location of this.targetLocations) {
                            for (let direction of this.targetDirections) {
                                this.blockTrials.push({
                                    cueType: cue,
                                    flankerType: flanker,
                                    targetLocation: location,
                                    targetDirection: direction
                                });
                            }
                        }
                    }
                }
                
                // Shuffle trials
                this.shuffleArray(this.blockTrials);
                
                // Limit to trialsPerBlock
                this.blockTrials = this.blockTrials.slice(0, this.trialsPerBlock);
            }

            shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            async runTrial() {
                if (!this.isActive || this.currentTrial >= this.trialsPerBlock) {
                    if (this.currentBlock < this.totalBlocks) {
                        await this.delay(1000);
                        this.runBlock();
                    } else {
                        this.endTest();
                    }
                    return;
                }
                
                this.currentCondition = this.blockTrials[this.currentTrial];
                this.currentTrial++;
                this.updateProgress();
                
                // Trial sequence
                await this.showFixation();
                await this.showCue();
                await this.showTarget();
            }

            async showFixation() {
                this.clearDisplay();
                this.fixation.classList.remove('hidden');
                
                // Variable fixation duration
                const duration = Math.random() * (this.fixationDuration.max - this.fixationDuration.min) + this.fixationDuration.min;
                await this.delay(duration);
            }

            async showCue() {
                const cueType = this.currentCondition.cueType;
                
                if (cueType === 'none') {
                    // No cue, just continue
                    return;
                }
                
                if (cueType === 'center') {
                    this.cueDisplay.innerHTML = '*';
                    this.cueDisplay.style.position = 'absolute';
                    this.cueDisplay.style.left = '50%';
                    this.cueDisplay.style.top = '50%';
                    this.cueDisplay.style.transform = 'translate(-50%, -50%)';
                    this.cueDisplay.classList.remove('hidden');
                } else if (cueType === 'double') {
                    // Create two asterisks above and below
                    const aboveCue = document.createElement('div');
                    aboveCue.className = 'cue-asterisk above';
                    aboveCue.textContent = '*';
                    aboveCue.style.position = 'absolute';
                    aboveCue.style.left = '50%';
                    aboveCue.style.top = '25%';
                    aboveCue.style.transform = 'translateX(-50%)';
                    
                    const belowCue = document.createElement('div');
                    belowCue.className = 'cue-asterisk below';
                    belowCue.textContent = '*';
                    belowCue.style.position = 'absolute';
                    belowCue.style.left = '50%';
                    belowCue.style.bottom = '25%';
                    belowCue.style.transform = 'translateX(-50%)';
                    
                    this.stimulusContainer.appendChild(aboveCue);
                    this.stimulusContainer.appendChild(belowCue);
                } else if (cueType === 'spatial') {
                    // Create asterisk at target location
                    const position = this.currentCondition.targetLocation;
                    const spatialCue = document.createElement('div');
                    spatialCue.className = `cue-asterisk ${position}`;
                    spatialCue.textContent = '*';
                    spatialCue.style.position = 'absolute';
                    spatialCue.style.left = '50%';
                    spatialCue.style.transform = 'translateX(-50%)';
                    
                    if (position === 'above') {
                        spatialCue.style.top = '25%';
                    } else {
                        spatialCue.style.bottom = '25%';
                    }
                    
                    this.stimulusContainer.appendChild(spatialCue);
                }
                
                await this.delay(this.cueDuration);
                
                // Clear cues and show fixation again
                this.clearDisplay();
                this.fixation.classList.remove('hidden');
                
                await this.delay(this.cueTargetInterval);
            }

            async showTarget() {
                this.clearDisplay();
                
                // Set arrow directions
                const direction = this.currentCondition.targetDirection;
                const flankerDirection = this.currentCondition.flankerType === 'congruent' ? direction : (direction === 'left' ? 'right' : 'left');
                
                const leftArrow = '←';
                const rightArrow = '→';
                
                this.targetArrow.textContent = direction === 'left' ? leftArrow : rightArrow;
                this.flanker1.textContent = flankerDirection === 'left' ? leftArrow : rightArrow;
                this.flanker2.textContent = flankerDirection === 'left' ? leftArrow : rightArrow;
                this.flanker3.textContent = flankerDirection === 'left' ? leftArrow : rightArrow;
                this.flanker4.textContent = flankerDirection === 'left' ? leftArrow : rightArrow;
                
                // Position arrows
                const location = this.currentCondition.targetLocation;
                this.arrowDisplay.style.position = 'absolute';
                this.arrowDisplay.style.left = '50%';
                this.arrowDisplay.style.transform = 'translateX(-50%)';
                
                if (location === 'above') {
                    this.arrowDisplay.style.top = '25%';
                    this.arrowDisplay.style.bottom = '';
                } else {
                    this.arrowDisplay.style.top = '';
                    this.arrowDisplay.style.bottom = '25%';
                }
                
                this.arrowDisplay.classList.remove('hidden');
                
                // Enable response collection
                this.awaitingResponse = true;
                this.trialStartTime = Date.now();
                this.leftBtn.disabled = false;
                this.rightBtn.disabled = false;
                
                // Set timeout
                this.responseTimer = setTimeout(() => {
                    if (this.awaitingResponse) {
                        this.handleResponse(null); // Timeout
                    }
                }, this.targetDuration);
            }

            handleResponse(response) {
                if (!this.awaitingResponse) return;
                
                this.awaitingResponse = false;
                clearTimeout(this.responseTimer);
                
                const reactionTime = response ? Date.now() - this.trialStartTime : this.targetDuration;
                const correct = response === this.currentCondition.targetDirection;
                
                // Flash button feedback
                if (response) {
                    const btn = response === 'left' ? this.leftBtn : this.rightBtn;
                    btn.classList.add(correct ? 'correct-flash' : 'incorrect-flash');
                    setTimeout(() => {
                        btn.classList.remove('correct-flash', 'incorrect-flash');
                    }, 300);
                }
                
                // Disable buttons
                this.leftBtn.disabled = true;
                this.rightBtn.disabled = true;
                
                // Record trial data
                this.trialData.push({
                    block: this.currentBlock,
                    trial: this.currentTrial,
                    cueType: this.currentCondition.cueType,
                    flankerType: this.currentCondition.flankerType,
                    targetLocation: this.currentCondition.targetLocation,
                    targetDirection: this.currentCondition.targetDirection,
                    response: response,
                    correct: correct,
                    reactionTime: reactionTime,
                    timestamp: Date.now() - this.startTime
                });
                
                // Show feedback
                if (this.mode === 'practice' || this.mode === 'child') {
                    this.showFeedback(correct, reactionTime);
                }
                
                // Clear display and continue
                setTimeout(() => {
                    this.clearDisplay();
                    this.fixation.classList.remove('hidden');
                    
                    setTimeout(() => {
                        this.runTrial();
                    }, 500);
                }, this.feedbackDuration);
            }

            showFeedback(correct, reactionTime) {
                this.feedbackText.className = 'feedback-text show';
                
                if (!correct && reactionTime >= this.targetDuration) {
                    this.feedbackText.textContent = 'Too Slow!';
                    this.feedbackText.classList.add('incorrect');
                } else if (correct) {
                    this.feedbackText.textContent = 'Correct!';
                    this.feedbackText.classList.add('correct');
                } else {
                    this.feedbackText.textContent = 'Incorrect';
                    this.feedbackText.classList.add('incorrect');
                }
                
                setTimeout(() => {
                    this.feedbackText.classList.remove('show', 'correct', 'incorrect');
                }, this.feedbackDuration - 200);
            }

            clearDisplay() {
                this.fixation.classList.add('hidden');
                this.cueDisplay.classList.add('hidden');
                this.cueDisplay.innerHTML = '';
                this.arrowDisplay.classList.add('hidden');
                this.arrowDisplay.style.top = '';
                this.arrowDisplay.style.bottom = '';
                
                // Remove any temporary cue asterisks
                document.querySelectorAll('.cue-asterisk').forEach(el => el.remove());
            }

            updateProgress() {
                const totalTrials = (this.currentBlock - 1) * this.trialsPerBlock + this.currentTrial;
                const maxTrials = this.totalBlocks * this.trialsPerBlock;
                const progress = (totalTrials / maxTrials) * 100;
                
                this.currentBlockDisplay.textContent = `${this.currentBlock}/${this.totalBlocks}`;
                this.currentTrialDisplay.textContent = this.currentTrial;
                this.progressFill.style.width = `${progress}%`;
                
                // Calculate running stats
                const correctTrials = this.trialData.filter(t => t.correct).length;
                this.correctCountDisplay.textContent = correctTrials;
                
                const validRTs = this.trialData.filter(t => t.correct && t.response).map(t => t.reactionTime);
                if (validRTs.length > 0) {
                    const avgRT = Math.round(validRTs.reduce((a, b) => a + b) / validRTs.length);
                    this.avgRTDisplay.textContent = `${avgRT} ms`;
                }
            }

            endTest() {
                this.isActive = false;
                this.awaitingResponse = false;
                clearTimeout(this.responseTimer);
                
                this.startBtn.disabled = false;
                this.restartBtn.disabled = true;
                this.leftBtn.disabled = true;
                this.rightBtn.disabled = true;
                
                this.clearDisplay();
                this.fixation.classList.remove('hidden');
                
                this.messageDisplay.style.display = 'block';
                this.messageDisplay.textContent = 'Test Complete! Check your attention network analysis below.';
                this.messageDisplay.className = 'message-display complete';
                
                document.getElementById('instructions').style.display = 'block';
                
                this.calculateResults();
            }

            calculateResults() {
                if (this.trialData.length === 0) {
                    this.resetResults();
                    return;
                }
                
                // Overall metrics
                const correctTrials = this.trialData.filter(t => t.correct).length;
                const accuracy = Math.round((correctTrials / this.trialData.length) * 100);
                const validRTs = this.trialData.filter(t => t.correct && t.response).map(t => t.reactionTime);
                const meanRT = validRTs.length > 0 ? Math.round(validRTs.reduce((a, b) => a + b) / validRTs.length) : 0;
                const errors = this.trialData.length - correctTrials;
                
                // Calculate mean RTs for each condition
                const getConditionRT = (cue, flanker) => {
                    const trials = this.trialData.filter(t => 
                        t.cueType === cue && 
                        t.flankerType === flanker && 
                        t.correct && 
                        t.response
                    );
                    return trials.length > 0 ? 
                        Math.round(trials.reduce((sum, t) => sum + t.reactionTime, 0) / trials.length) : 0;
                };
                
                // Get RTs for network calculations
                const noCueRT = (getConditionRT('none', 'congruent') + getConditionRT('none', 'incongruent')) / 2;
                const doubleCueRT = (getConditionRT('double', 'congruent') + getConditionRT('double', 'incongruent')) / 2;
                const centerCueRT = (getConditionRT('center', 'congruent') + getConditionRT('center', 'incongruent')) / 2;
                const spatialCueRT = (getConditionRT('spatial', 'congruent') + getConditionRT('spatial', 'incongruent')) / 2;
                
                // Calculate network scores
                const alertingScore = noCueRT - doubleCueRT;
                const orientingScore = centerCueRT - spatialCueRT;
                
                // Executive score (across all cue types)
                const congruentRT = this.trialData
                    .filter(t => t.flankerType === 'congruent' && t.correct && t.response)
                    .reduce((sum, t) => sum + t.reactionTime, 0);
                const congruentCount = this.trialData.filter(t => t.flankerType === 'congruent' && t.correct && t.response).length;
                
                const incongruentRT = this.trialData
                    .filter(t => t.flankerType === 'incongruent' && t.correct && t.response)
                    .reduce((sum, t) => sum + t.reactionTime, 0);
                const incongruentCount = this.trialData.filter(t => t.flankerType === 'incongruent' && t.correct && t.response).length;
                
                const executiveScore = congruentCount > 0 && incongruentCount > 0 ?
                    Math.round((incongruentRT / incongruentCount) - (congruentRT / congruentCount)) : 0;
                
                // Update displays
                document.getElementById('overallAccuracy').textContent = `${accuracy}%`;
                document.getElementById('meanRT').textContent = `${meanRT}`;
                document.getElementById('totalErrors').textContent = errors;
                document.getElementById('trialsCompleted').textContent = this.trialData.length;
                
                document.getElementById('alertingScore').textContent = alertingScore > 0 ? `${Math.round(alertingScore)} ms` : '-';
                document.getElementById('orientingScore').textContent = orientingScore > 0 ? `${Math.round(orientingScore)} ms` : '-';
                document.getElementById('executiveScore').textContent = executiveScore > 0 ? `${executiveScore} ms` : '-';
                
                // Condition breakdown
                const updateConditionRow = (cueType, rowPrefix) => {
                    const congRT = getConditionRT(cueType, 'congruent');
                    const incongRT = getConditionRT(cueType, 'incongruent');
                    const trials = this.trialData.filter(t => t.cueType === cueType);
                    const correct = trials.filter(t => t.correct).length;
                    const acc = trials.length > 0 ? Math.round((correct / trials.length) * 100) : 0;
                    
                    document.getElementById(`${rowPrefix}CongRT`).textContent = congRT || '-';
                    document.getElementById(`${rowPrefix}IncongRT`).textContent = incongRT || '-';
                    document.getElementById(`${rowPrefix}Acc`).textContent = acc ? `${acc}%` : '-';
                };
                
                updateConditionRow('none', 'noCue');
                updateConditionRow('center', 'centerCue');
                updateConditionRow('double', 'doubleCue');
                updateConditionRow('spatial', 'spatialCue');
                
                // Performance indicators
                this.updatePerformanceIndicator('accuracyPerformance', accuracy, [95, 90, 85]);
                this.updatePerformanceIndicator('rtPerformance', meanRT, [500, 600, 700], true);
                this.updatePerformanceIndicator('alertingPerformance', alertingScore, [30, 50, 70]);
                this.updatePerformanceIndicator('orientingPerformance', orientingScore, [30, 50, 70]);
                this.updatePerformanceIndicator('executivePerformance', executiveScore, [100, 150, 200], true);
            }

            updatePerformanceIndicator(elementId, value, thresholds, reverse = false) {
                const element = document.getElementById(elementId);
                if (!element || value === null || value === '-' || isNaN(value) || value === 0) {
                    element.textContent = '-';
                    element.className = 'performance-indicator';
                    return;
                }
                
                let performance, className;

                if (reverse) {
                    // Lower is better
                    if (value < thresholds[0]) {
                        performance = 'Excellent';
                        className = 'excellent';
                    } else if (value < thresholds[1]) {
                        performance = 'Good';
                        className = 'good';
                    } else if (value < thresholds[2]) {
                        performance = 'Average';
                        className = 'average';
                    } else {
                        performance = 'Poor';
                        className = 'poor';
                    }
                } else {
                    // Higher is better
                    if (value >= thresholds[0]) {
                        performance = 'Excellent';
                        className = 'excellent';
                    } else if (value >= thresholds[1]) {
                        performance = 'Good';
                        className = 'good';
                    } else if (value >= thresholds[2]) {
                        performance = 'Average';
                        className = 'average';
                    } else {
                        performance = 'Poor';
                        className = 'poor';
                    }
                }

                element.textContent = performance;
                element.className = `performance-indicator ${className}`;
            }

            resetResults() {
                document.getElementById('overallAccuracy').textContent = '-';
                document.getElementById('meanRT').textContent = '-';
                document.getElementById('totalErrors').textContent = '-';
                document.getElementById('trialsCompleted').textContent = '0';
                
                document.getElementById('alertingScore').textContent = '-';
                document.getElementById('orientingScore').textContent = '-';
                document.getElementById('executiveScore').textContent = '-';
                
                ['noCue', 'centerCue', 'doubleCue', 'spatialCue'].forEach(prefix => {
                    document.getElementById(`${prefix}CongRT`).textContent = '-';
                    document.getElementById(`${prefix}IncongRT`).textContent = '-';
                    document.getElementById(`${prefix}Acc`).textContent = '-';
                });
                
                ['accuracyPerformance', 'rtPerformance', 'alertingPerformance', 
                 'orientingPerformance', 'executivePerformance'].forEach(id => {
                    const element = document.getElementById(id);
                    element.textContent = '-';
                    element.className = 'performance-indicator';
                });
            }

            restartTest() {
                this.endTest();
                this.resetTest();
                setTimeout(() => this.startTest(), 100);
            }

            resetTest() {
                this.endTest();
                
                this.currentBlock = 0;
                this.currentTrial = 0;
                this.trialData = [];
                this.blockData = [];
                
                this.startBtn.disabled = false;
                this.restartBtn.disabled = true;
                
                this.messageDisplay.textContent = 'Click START to begin measuring your attention networks';
                this.messageDisplay.className = 'message-display waiting';
                this.messageDisplay.style.display = 'block';
                
                this.clearDisplay();
                this.fixation.classList.remove('hidden');
                
                this.currentBlockDisplay.textContent = '0/4';
                this.currentTrialDisplay.textContent = '0';
                this.correctCountDisplay.textContent = '0';
                this.avgRTDisplay.textContent = '-';
                this.progressFill.style.width = '0%';
                
                document.getElementById('instructions').style.display = 'block';
                
                this.resetResults();
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // Initialize the test when the page loads
        window.addEventListener('load', () => {
            new AttentionNetworkTest();
        });
    </script>
</body>
</html>